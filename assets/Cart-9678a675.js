import{c as E}from"./cart-917508c9.js";import{p as N}from"./pendingOrder-0682c896.js";import{_ as P,l as A,t as k,r as S,o as a,c,b as o,F as f,A as x,n as C,w as O,O as Y,j as M,B as l,p as B,f as T,u as U,k as I,v as z,z as y,h as b}from"./index-bc9b52c7.js";import{c as V}from"./coupon-e2d87e07.js";import{t as D}from"./date-44c8fab1.js";import{a as F}from"./util-14ba5627.js";import"./api-b0d317f2.js";import"./sweetAlert-7015f24b.js";const R={setup(d,s){const i=V(),e=A(),u=k(()=>i.pagination.current_page),_=k(()=>i.pagination.total_pages),t=S(null),{emit:p}=s,n=()=>{p("applyCoupon",t.value)},g=async(m=1)=>{e.showLoading(),await i.getCoupons(m),e.hideLoading()},r=m=>{const w=new Date;return new Date(m)<w},h=k(()=>i.coupons.sort((m,w)=>{const L=new Date(D(m.due_date));return new Date(D(w.due_date))-L}));return{selectedCoupon:t,applyCoupon:n,coupon:i,timestampToYMD:D,currentPage:u,totalPages:_,getCoupons:g,isExpired:r,showData:h}}},j=d=>(B("data-v-e3e56535"),d=d(),T(),d),q={class:"modal fade",id:"couponModal",tabindex:"-1","aria-labelledby":"couponModalLabel","aria-hidden":"true"},G={class:"modal-dialog modal-dialog-centered modal-lg modal-dialog-scrollable"},H={class:"modal-content"},J=j(()=>o("div",{class:"modal-header"},[o("h1",{class:"modal-title fs-5",id:"couponModalLabel"},"可使用優惠券"),o("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),K={class:"modal-body"},Q=["for"],W={class:"container-fluid"},X={class:"row"},Z={class:"col-2 border-end"},$={class:"d-center align-items-center h-100"},oo=["id","value"],eo={class:"col-8 col-md-6"},to={class:"d-column py-2"},so={class:"text-secondary fs-small mb-2"},no={class:"text-secondary fs-small mb-2"},ao={class:"text-secondary fs-small mb-0"},co={class:"col-2 col-md border-start"},lo={class:"d-center align-items-center h-100"},io={key:0,class:"d-end mt-3 pe-3"},ro={"aria-label":"Page navigation example"},_o={class:"pagination"},po=["onClick"],mo={class:"page-link"},uo={class:"modal-footer d-center"};function ho(d,s,i,e,u,_){return a(),c("div",q,[o("div",G,[o("div",H,[J,o("div",K,[(a(!0),c(f,null,x(e.showData,(t,p)=>(a(),c("label",{key:p,class:C(["card card-hover-shadow mb-3",{expired:e.isExpired(e.timestampToYMD(t.due_date))}]),for:t.code,role:"button"},[o("div",W,[o("div",X,[o("div",Z,[o("div",$,[e.isExpired(e.timestampToYMD(t.due_date))?M("",!0):O((a(),c("input",{key:0,class:"form-check-input",type:"radio",name:"coupon",id:t.code,value:{code:t.code,percent:t.percent},"onUpdate:modelValue":s[0]||(s[0]=n=>e.selectedCoupon=n)},null,8,oo)),[[Y,e.selectedCoupon]])])]),o("div",eo,[o("div",to,[o("p",so," 套用活動："+l(t.title),1),o("p",no," 優惠代碼："+l(t.code),1),o("p",ao," 有效期限："+l(e.timestampToYMD(t.due_date)),1)])]),o("div",co,[o("div",lo,l(t.percent/10)+"折 ",1)])])])],10,Q))),128))]),e.totalPages>1?(a(),c("div",io,[o("nav",ro,[o("ul",_o,[o("li",{class:C(["page-item",{invisible:e.currentPage===1}])},[o("a",{class:"page-link",onClick:s[1]||(s[1]=t=>e.getCoupons(e.currentPage-1))},"上一頁")],2),(a(!0),c(f,null,x(e.totalPages,(t,p)=>(a(),c("li",{class:C(["page-item",{active:e.currentPage===t}]),key:p,onClick:n=>e.getCoupons(t)},[o("a",mo,l(t),1)],10,po))),128)),o("li",{class:C(["page-item",{invisible:e.currentPage===e.totalPages}])},[o("a",{class:"page-link",onClick:s[2]||(s[2]=t=>e.getCoupons(e.currentPage+1))},"下一頁")],2)])])])):M("",!0),o("div",uo,[o("button",{type:"button",class:"btn btn-primary w-50","data-bs-dismiss":"modal","aria-label":"Close",onClick:s[3]||(s[3]=(...t)=>e.applyCoupon&&e.applyCoupon(...t))}," 套用 ")])])])])}const bo=P(R,[["render",ho],["__scopeId","data-v-e3e56535"]]);const vo={components:{CouponModal:bo},setup(d){const s=U(),i=V(),e=A();e.showLoading(),F().then(async()=>{await i.getCoupons(),e.hideLoading()});const u=E(),_=S(""),t=S(!1);return{cart:u,changeCount:(h,m)=>u.changeItemCount(m,h.target.value),setCoupon:h=>{_.value={...h},t.value=!0},selectedCoupon:_,availableCoupon:t,removeCoupon:()=>{t.value=!1,_.value=""},confirmOrder:()=>{N().setInfo({availableCoupon:t.value,selectedCoupon:_.value,orderId:""}),s.push("/eStore/confirmOrder")},router:s}}},v=d=>(B("data-v-125e647c"),d=d(),T(),d),go={key:0,class:"container-fluid pt-2"},fo={class:"row"},Co={class:"col-lg-7 col-xl-7"},yo={class:"table-responsive"},xo={class:"table table-hover"},wo=v(()=>o("thead",null,[o("tr",null,[o("th",{scope:"col",class:"text-center mobile-hide"},"商品圖片"),o("th",{scope:"col"},"商品名稱"),o("th",{scope:"col"},"數量"),o("th",{scope:"col"},"單價"),o("th",{scope:"col",class:"text-center"},"操作")])],-1)),ko={scope:"row",class:"mobile-hide"},Do={class:"d-center"},So=["src","alt","title"],Mo={class:"mb-0 line-clamp-2"},Lo={class:"d-end"},Io=["onChange"],Po=["selected"],Ao={class:"text-center"},Oo={class:"col mb-2"},Bo={class:"card p-3 shadow"},To=v(()=>o("h2",{class:"fs-5 mb-3 border-bottom pb-2"},"訂單金額",-1)),Vo={class:"d-flex align-items-center mb-3"},Eo=v(()=>o("label",{for:"coupon",class:"form-label me-2 mb-0 text-nowrap"},"優惠券",-1)),No=["disabled"],Yo={class:"d-between mb-2 align-items-center"},Uo={class:"fs-6 text-decoration-underline mb-0",role:"button","data-bs-toggle":"modal","data-bs-target":"#couponModal"},zo={key:0,class:"d-flex align-items-center fs-6 text-secondary border rounded ps-2 pe-1 py-1 mb-1"},Fo={class:"d-column align-items-end mt-2"},Ro={class:"d-between w-40 text-nowrap"},jo=v(()=>o("span",{class:"fs-6 mb-1 text-secondary"}," 小記 ",-1)),qo={class:"fs-6 mb-1 text-secondary"},Go={class:"d-between w-40 text-nowrap"},Ho=v(()=>o("span",{class:"fs-6 mb-1 text-secondary"}," 折扣 ",-1)),Jo={class:"fs-6 mb-1 text-secondary"},Ko={class:"d-end text-nowrap border-top pt-2 mt-2"},Qo=v(()=>o("span",{class:"fs-4 mb-1 me-2"}," 總金額 ",-1)),Wo={class:"fs-4 mb-1"},Xo={class:"d-end mt-3"},Zo={key:1,class:"empty-text"};function $o(d,s,i,e,u,_){const t=I("font-awesome-icon"),p=I("CouponModal");return a(),c(f,null,[e.cart.cartItems.length>0?(a(),c("div",go,[o("div",fo,[o("div",Co,[o("div",yo,[o("table",xo,[wo,o("tbody",null,[(a(!0),c(f,null,x(e.cart.cartItems,(n,g)=>(a(),c("tr",{key:n},[o("th",ko,[o("div",Do,[o("img",{src:n.info.imageUrl,alt:n.info.title,title:n.info.title},null,8,So)])]),o("td",null,[o("p",Mo,l(n.info.title),1)]),o("td",null,[o("div",Lo,[o("select",{class:"form-select",onChange:r=>e.changeCount(r,g)},[(a(),c(f,null,x(30,r=>o("option",{selected:r==n.count,key:r},l(r),9,Po)),64))],40,Io)])]),o("td",null,l(n.info.price.toLocaleString()),1),o("td",Ao,[b(t,{role:"button",icon:"fa-trash-can",class:"text-secondary",onClick:r=>e.cart.delItem(g)},null,8,["onClick"])])]))),128))])])])]),o("div",Oo,[o("div",Bo,[To,o("div",Vo,[Eo,O(o("input",{type:"text",class:"form-control form-control-sm",id:"coupon",placeholder:"請輸入優惠代碼","onUpdate:modelValue":s[0]||(s[0]=n=>e.selectedCoupon.code=n),disabled:e.availableCoupon},null,8,No),[[z,e.selectedCoupon.code]])]),o("div",Yo,[o("p",Uo,[y(" 選用優惠券"),b(t,{class:"ms-1",icon:"fa-solid fa-arrow-right"})]),e.availableCoupon?(a(),c("div",zo,[b(t,{icon:"fa-ticket",class:"me-4"}),y(" "+l(e.selectedCoupon.code)+" ",1),o("button",{type:"button",class:"btn-close pe-0 ms-4",onClick:s[1]||(s[1]=(...n)=>e.removeCoupon&&e.removeCoupon(...n))})])):M("",!0)]),o("div",Fo,[o("div",Ro,[jo,o("span",qo," $ "+l(e.cart.cartAmount.toLocaleString()),1)]),o("div",Go,[Ho,o("span",Jo," $ "+l(e.availableCoupon?(e.cart.cartAmount-e.cart.cartAmount*(e.selectedCoupon.percent/100)).toLocaleString():0),1)])]),o("div",Ko,[Qo,o("span",Wo," $ "+l(e.availableCoupon?(e.cart.cartAmount*(e.selectedCoupon.percent/100)).toLocaleString():e.cart.cartAmount.toLocaleString()),1)]),o("div",Xo,[o("button",{class:"btn btn-primary ms-md-1 w-100",onClick:s[2]||(s[2]=(...n)=>e.confirmOrder&&e.confirmOrder(...n))},[b(t,{icon:"fa-coins"}),y("結帳 ")])])])])])])):(a(),c("h2",Zo,[y(" 目前還未將商品加入購物車 "),b(t,{class:"ms-2",icon:"fa-face-frown"})])),b(p,{onApplyCoupon:e.setCoupon},null,8,["onApplyCoupon"])],64)}const ie=P(vo,[["render",$o],["__scopeId","data-v-125e647c"]]);export{ie as default};
