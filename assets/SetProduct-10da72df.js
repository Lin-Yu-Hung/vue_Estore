import{b as B,j as te,c as le,e as ae}from"./api-f8285795.js";import{e as k,s as K,d as oe}from"./sweetAlert-8456748e.js";import{_ as se,C as ie,D as ne,E as de,r as f,a as re,l as ce,k as me,m as ue,n as pe,t as C,o as u,c as p,b as e,y as j,h as d,w as L,v as q,F as H,z as O,j as T,i as R,H as w,O as z,x as W,p as _e,f as ge}from"./index-0fd04afb.js";import{p as fe}from"./product-18b7ebc8.js";import{u as G}from"./util-2dfebd07.js";const ve={components:{Field:ie,Form:ne,ErrorMessage:de},setup(E,a){let V=f(""),t=f(null),P=f([]);const v=f([]),s=f({title:"",category:"",origin_price:0,price:0,unit:"",description:"",content:"",is_enabled:1}),_=re(),r=ce();me(()=>_.path,i=>{I.value=_.fullPath==="/dashboard/editProduct",A()});const S=f(""),n=f(""),l=f({}),m=fe();console.log(m.editData);const{productList:F}=ue(m),I=f(_.fullPath==="/dashboard/editProduct"),D=f(),M=()=>{F.value.forEach(i=>{l.value[i.id]=i})},Q=pe(()=>F.value.length>0?(M(),F.value.filter(i=>i.title.match(n.value))):[]),J=i=>{s.value=JSON.parse(JSON.stringify(i)),V.value=i.imageUrl,i.imagesUrl?v.value=JSON.parse(JSON.stringify(i.imagesUrl)):v.value.splice(0),S.value=i.id},X=async()=>{if(r.showLoading(),t.value!==null){const c=new FormData;c.append("file-to-upload",t.value);try{const g=await B(c);console.log(g),g.status===200&&(s.value.imageUrl=g.data.imageUrl)}catch(g){console.log(g)}t.value=null}else s.value.imageUrl=V.value;if(P.value.length!==0){const c=P.value.map(async y=>{const N=new FormData;N.append("file-to-upload",y);try{const U=await B(N);return U.status===200?U.data.imageUrl:null}catch{return null}}),g=await Promise.all(c);g.some(y=>y===null)?k("上傳失敗","請稍後在試或使用其他檔案"):!s.value.imagesUrl||s.value.imagesUrl.length===0?s.value.imagesUrl=[...g]:(console.log("🚀  data.value.imagesUrl:",s.value.imagesUrl),s.value.imagesUrl.push(...g)),P.value.splice(0)}else s.value.imagesUrl=[...v.value];const i={data:{...s.value}},b=I.value?te:le,x=I.value?"編輯":"建立";try{const c=await b(i);console.log(c),c.data.success?(await m.getAllProductData(),K(`${x}成功!`),I.value||A()):k(`${x}失敗!`)}catch(c){k(`${x}失敗!`),console.log(c)}finally{r.hideLoading()}},Y=async(i,b="main")=>{const x=[...i.target.files],c=i.target.files.length;if(c===0)return;if(b!=="main"&&(c>5||c+v.value.length>5)){k("最多上傳5筆檔案");return}if(x.some(h=>!h.type||h.type!=="image/jpeg"&&h.type!=="image/png")){r.hideLoading(),k("檔案格式錯誤","僅能上傳jpg、png類型檔案");return}if(r.showLoading(),b=="main"){const h=x[0];try{const y=await G(h);V.value=y.result,t.value=h}catch{k("上傳失敗","請稍後在試或使用其他檔案")}}else{const h=x.map(async U=>{try{return(await G(U)).result}catch{return null}}),y=await Promise.all(h);y.some(U=>U===null)?k("上傳失敗","請稍後在試或使用其他檔案"):(v.value.push(...y),P.value=[...x],console.log("🚀  tempImgFiles.value:",P.value))}r.hideLoading()},Z=i=>{v.value.splice(i,1),s.value.imagesUrl.splice(i,1)},$=async()=>{if(await oe(s.value.title)){r.showLoading();try{const b=await ae(s.value.id);console.log(b),b.data.success&&(await m.getAllProductData(),K("刪除成功!"),A())}catch(b){console.log(b)}finally{r.hideLoading()}}},A=async()=>{s.value={title:"",category:"",origin_price:0,price:0,unit:"",description:"",content:"",is_enabled:1},V.value="",v.value.splice(0),S.value="",setTimeout(()=>{D.value&&D.value.resetForm()},0)};return I.value&&(F.value.length===0?(r.showLoading(),m.getAllProductData().then(()=>{M(),r.hideLoading()})):M(),Object.keys(m.editData).length>0&&(J(m.editData),m.setEditData({}))),{data:s,imageUrl:V,imageList:v,isEditStatus:I,filterProductList:Q,selectEditProduct:S,productKeyword:n,editDataMap:l,form:D,setProduct:X,uploadImg:Y,delImage:Z,setEditData:J,deleteProduct:$}}},o=E=>(_e("data-v-4bc1e441"),E=E(),ge(),E),be={class:"card pt-2"},he={class:"px-2 mb-2 d-between"},ye={class:"mb-0"},we={key:0,class:"input-group border rounded d-flex align-items-center"},xe=["value"],Ue={class:"dropdown-menu w-100 border-top-0"},ke={class:"px-2 pt-1"},Ve={class:"product-list ps-0 mt-2 mb-0"},Pe=["onClick","value"],Ie={class:"row border-top"},Ee={class:"col-md border-end pt-2"},Se=o(()=>e("label",{for:"name",class:"form-label"},"是否啟用",-1)),Fe={class:"form-check form-check-inline ms-3 mb-3"},Le=o(()=>e("label",{class:"form-check-label",for:"is_enableTrue",role:"button"},"是",-1)),Ce={class:"form-check form-check-inline"},De=o(()=>e("label",{class:"form-check-label",for:"is_enableFalse",role:"button"},"否",-1)),Me={class:"mb-3"},Ae=o(()=>e("label",{for:"name",class:"form-label"},"商品名稱",-1)),Ne={class:"row mb-3"},je={class:"col-md mb-3 mb-md-0"},qe=o(()=>e("label",{for:"category",class:"form-label"},"分類",-1)),He=o(()=>e("option",{selected:"",value:"",disabled:""},"請選擇分類",-1)),Oe=o(()=>e("option",{value:"手機"},"手機",-1)),Te=o(()=>e("option",{value:"平板"},"平板",-1)),Je=o(()=>e("option",{value:"電腦"},"電腦",-1)),Be=o(()=>e("option",{value:"遊戲機"},"遊戲機",-1)),Ke=o(()=>e("option",{value:"3C配件"},"3C配件",-1)),Re=o(()=>e("option",{value:"智慧手錶"},"智慧手錶",-1)),ze={class:"col-md"},We=o(()=>e("label",{for:"unit",class:"form-label"},"單位",-1)),Ge={class:"row mb-3"},Qe={class:"col-md mb-3 mb-md-0"},Xe=o(()=>e("label",{for:"origin_price",class:"form-label"},"原價",-1)),Ye={class:"col-md"},Ze=o(()=>e("label",{for:"price",class:"form-label"},"售價",-1)),$e={class:"mb-3"},et=o(()=>e("label",{for:"name",class:"form-label"},"產品描述",-1)),tt={class:"mb-3"},lt=o(()=>e("label",{for:"name",class:"form-label"},"說明內容",-1)),at={class:"col-md-5 col-lg-4 col-xxxl-3 d-column justify-content-between"},ot={class:"pt-2"},st=o(()=>e("h5",{class:"my-2"},"商品主圖",-1)),it=o(()=>e("hr",{class:"mt-0 mb-2"},null,-1)),nt={key:0,class:"uploadImg template-image mb-3",for:"uploadImg",role:"button"},dt={class:"d-column"},rt=o(()=>e("p",{class:"text-secondary mb-0"},"商品主圖",-1)),ct={key:1,class:"position-relative my-2"},mt=["src","alt"],ut=o(()=>e("h5",{class:"my-2"},"商品附圖",-1)),pt=o(()=>e("hr",{class:"mt-0 mb-2"},null,-1)),_t={class:"d-flex flex-wrap"},gt=["onClick"],ft=["src","alt"],vt={class:"d-column"},bt=o(()=>e("p",{class:"text-secondary mb-0"},"商品附圖",-1)),ht={class:"d-flex mt-3 mb-2"},yt=["disabled"];function wt(E,a,V,t,P,v){const s=C("font-awesome-icon"),_=C("Field"),r=C("ErrorMessage"),S=C("Form");return u(),p("div",be,[e("div",he,[e("h2",ye,j(t.isEditStatus?"修改":"建立")+"商品",1),t.isEditStatus?(u(),p("div",we,[e("input",{type:"text",class:"form-control border-0 rounded",readonly:"",role:"button",placeholder:"請選擇編輯商品","data-bs-toggle":"dropdown","data-bs-auto-close":"true","aria-expanded":"false",value:t.selectEditProduct?t.editDataMap[t.selectEditProduct].title:""},null,8,xe),d(s,{"data-bs-toggle":"dropdown","data-bs-auto-close":"true",role:"button","aria-expanded":"false",class:"me-3",icon:"fa-chevron-down"}),e("div",Ue,[e("div",ke,[L(e("input",{type:"text",placeholder:"查詢商品名稱",class:"form-control-sm border rounded w-100","onUpdate:modelValue":a[0]||(a[0]=n=>t.productKeyword=n)},null,512),[[q,t.productKeyword]]),e("ul",Ve,[(u(!0),p(H,null,O(t.filterProductList,n=>(u(),p("li",{class:w(["py-1",{active:t.selectEditProduct===n.id}]),onClick:l=>(t.selectEditProduct=n.id,t.setEditData(t.editDataMap[n.id])),key:n.id,value:n.id},j(n.title),11,Pe))),128))])])])])):T("",!0)]),d(S,{class:w([{cover:!t.selectEditProduct&&t.isEditStatus},"container-fluid"]),ref:"form",onSubmit:t.setProduct},{default:R(({errors:n})=>[e("div",Ie,[e("div",Ee,[Se,e("div",Fe,[L(e("input",{class:"form-check-input",type:"radio",name:"is_enable",id:"is_enableTrue",value:1,"onUpdate:modelValue":a[1]||(a[1]=l=>t.data.is_enabled=l),checked:""},null,512),[[z,t.data.is_enabled]]),Le]),e("div",Ce,[L(e("input",{class:"form-check-input",type:"radio",name:"is_enable",id:"is_enableFalse","onUpdate:modelValue":a[2]||(a[2]=l=>t.data.is_enabled=l),value:2},null,512),[[z,t.data.is_enabled]]),De]),e("div",Me,[Ae,d(_,{id:"title",name:"商品名稱",type:"text",rules:"required",class:w(["formInput form-control",{"is-invalid":n.商品名稱}]),placeHolder:"請輸入商品名稱",modelValue:t.data.title,"onUpdate:modelValue":a[3]||(a[3]=l=>t.data.title=l)},null,8,["class","modelValue"]),d(r,{class:"text-danger invalid-feedback",name:"商品名稱"})]),e("div",Ne,[e("div",je,[qe,d(_,{as:"select",id:"category",name:"分類",rules:"required",class:w(["form-select",{"is-invalid":n.分類}]),modelValue:t.data.category,"onUpdate:modelValue":a[4]||(a[4]=l=>t.data.category=l)},{default:R(()=>[He,Oe,Te,Je,Be,Ke,Re]),_:2},1032,["class","modelValue"]),d(r,{class:"text-danger invalid-feedback",name:"分類"})]),e("div",ze,[We,d(_,{id:"unit",name:"單位",type:"text",rules:"required",class:w(["formInput form-control",{"is-invalid":n.單位}]),placeHolder:"請輸入單位",modelValue:t.data.unit,"onUpdate:modelValue":a[5]||(a[5]=l=>t.data.unit=l)},null,8,["class","modelValue"]),d(r,{class:"text-danger invalid-feedback",name:"單位"})])]),e("div",Ge,[e("div",Qe,[Xe,d(_,{id:"origin_price",name:"原價",type:"number",rules:"required",class:w(["formInput form-control",{"is-invalid":n.原價}]),placeHolder:"請輸入原價",modelValue:t.data.origin_price,"onUpdate:modelValue":a[6]||(a[6]=l=>t.data.origin_price=l),modelModifiers:{number:!0}},null,8,["class","modelValue"]),d(r,{class:"text-danger invalid-feedback",name:"原價"})]),e("div",Ye,[Ze,d(_,{id:"price",name:"售價",type:"number",rules:"required",class:w(["formInput form-control",{"is-invalid":n.售價}]),placeHolder:"請輸入售價",modelValue:t.data.price,"onUpdate:modelValue":a[7]||(a[7]=l=>t.data.price=l),modelModifiers:{number:!0}},null,8,["class","modelValue"]),d(r,{class:"text-danger invalid-feedback",name:"售價"})])]),e("div",$e,[et,d(_,{as:"textarea",name:"產品描述",type:"text",rules:"required",rows:"4",class:w(["form-control",{"is-invalid":n.產品描述}]),placeHolder:"請輸入產品描述",modelValue:t.data.description,"onUpdate:modelValue":a[8]||(a[8]=l=>t.data.description=l)},null,8,["class","modelValue"]),d(r,{class:"text-danger invalid-feedback",name:"產品描述"})]),e("div",tt,[lt,L(e("textarea",{rows:"4",class:"form-control",placeholder:"請輸入產品說明內容","onUpdate:modelValue":a[9]||(a[9]=l=>t.data.content=l)},null,512),[[q,t.data.content]])])]),e("div",at,[e("div",ot,[st,it,t.imageUrl?(u(),p("div",ct,[e("button",{type:"button",class:"btn-close position-absolute top-0","aria-label":"Close",onClick:a[10]||(a[10]=l=>t.imageUrl="")}),e("img",{class:"uploadImg mb-3",src:t.imageUrl,alt:t.imageUrl},null,8,mt)])):(u(),p("label",nt,[e("div",dt,[d(s,{class:"fs-2 mb-2 me-0 text-secondary",icon:"fa-image"}),rt])])),L(e("input",{type:"text","onUpdate:modelValue":a[11]||(a[11]=l=>t.imageUrl=l),class:"form-control rounded",placeholder:"輸入圖片網址"},null,512),[[q,t.imageUrl]]),e("input",{onChange:a[12]||(a[12]=(...l)=>t.uploadImg&&t.uploadImg(...l)),id:"uploadImg",class:"form-control d-none",type:"file"},null,32),ut,pt,e("div",_t,[t.imageList.length>0?(u(!0),p(H,{key:0},O(t.imageList,(l,m)=>(u(),p("div",{class:"position-relative",key:l},[e("button",{type:"button",class:"btn-close position-absolute top-0","aria-label":"Close",onClick:F=>t.delImage(m)},null,8,gt),e("img",{class:"uploadImgs mb-3",src:l,alt:l},null,8,ft)]))),128)):T("",!0),(u(!0),p(H,null,O(5-t.imageList.length,(l,m)=>(u(),p("label",{key:m,class:"uploadImgs template-image",for:"uploadImgs",role:"button"},[e("div",vt,[d(s,{class:"fs-4 mb-2 me-0 text-secondary",icon:"fa-image"}),bt])]))),128)),e("input",{onChange:a[13]||(a[13]=l=>t.uploadImg(l,"multiple")),type:"file",class:"form-control d-none",id:"uploadImgs",multiple:""},null,32)])]),e("div",ht,[t.isEditStatus?(u(),p("button",{key:0,type:"button",class:"btn btn-danger text-white w-50 me-2",onClick:a[14]||(a[14]=(...l)=>t.deleteProduct&&t.deleteProduct(...l)),disabled:!t.selectEditProduct},[d(s,{icon:"fa-trash-can",class:"me-1"}),W("刪除商品 ")],8,yt)):T("",!0),e("button",{type:"submit",class:w(["btn btn-primary flex-grow-1",{"ms-2":t.isEditStatus}])},[d(s,{icon:"fa-edit",class:"me-1"}),W(j(t.isEditStatus?"修改":"建立")+"商品 ",1)],2)])])])]),_:1},8,["class","onSubmit"])])}const It=se(ve,[["render",wt],["__scopeId","data-v-4bc1e441"]]);export{It as default};
