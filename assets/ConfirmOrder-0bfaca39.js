import{f as V,g as P,s as U}from"./api-4070729c.js";import{e as B}from"./sweetAlert-c19bab2b.js";import{_ as D,C as W,D as N,E as O,r as j,l as J,u as R,t as w,o as x,c as S,b as e,F,z as X,h as c,i as M,y as h,H as C,w as z,v as T,x as I,j as Z,p as K,f as Q}from"./index-b2cc45bb.js";import{c as H}from"./cart-3174f42e.js";import{p as Y}from"./pendingOrder-3504e7b5.js";const G="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEoAAAAWCAYAAABnnAr9AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAttJREFUeNrsWDFoE1EY/isZggqecIJDIRk6VBAp6FqJU10q6tClFnSpS4d2cKrQBHTqkIqd6tBCMzlorYudoumqmEpBB4dEOhSa4QSRDoL+3/Xe+fead3lpcucJ+eAn79696919/b7v/UkfJRjp8rjFH8tc1j9+lHcpSjamuW4m4DlyJ6gHI/SI6hHVXSCjfntjh+tsSFYUvfEK1z2ulyI/1JxE8O/muMohzxJ2fx+XTmdofuDOobn6foMWd97Qpx/1SIlSCNtZ5Llsk7m7XK+41lpcS4b30OKGfZmuWheOzE+cH6ax7SK9bnxIvPWWBYmxAAqqOJ/94/mBiVgU1SlUz3PNYO1bw3WhePC15BIFK071X6dM2natWd/fo4fZ2+6csiZIPZM6SaXdTVpvvKfnF2fcczhe3a24Y1wz7Kl1pPo4MqLIyyHk2YIBqTkNgW0jkz4n8mqPng3ep1G26N/ztlvAJhP7/ddPdwwL41oQBRJBLD5XmbyoFFUTtisavPCQJtj72rnpxtDsoWOoy0qd8kmCiqA6EDLLapGAkg6Isn3CQNLBuUpkGTXj7VoyryjuvJr8suQrBxjbXnDJe1R7cWRHhIqUsqCkqf4R36Yy97qtKEe0DEoxrdZXm8y1BVjkG1sNL6ZeThKFMawIpUh7SrJAkrQp2oyow3zNy6Zpg7XVboQ5LBL872+xcqAUkIPABhmj9hXfVhKLOxt+4EvyTIjKN1mz0sazF7wmtFWbkNXcK98peSAJubQ0OOkHtA51T42qL4NClR1bETXX4U4E+9zi+mhA1NxxiFoXDeWWphOHKkCC2sWw0zlMgMXjoALRoCqiSho1RdEeKFsVNER0JbRNvqrI3AoDOvqwEJdEFQxevNZEYU/wg5ZYE1SG4/VLToDAMDXGCjSnqLAQP1bfEjfS5fF8VMpUjapS1FMmSpdPUVnvvwFyDD1W7/eohP56EAWqSXmOPwIMAC4oGDA1oHZWAAAAAElFTkSuQmCC";const $={components:{Field:W,Form:N,ErrorMessage:O},setup(g){const n=j({user:{name:"測試人員",email:"zxcv96197@gmail.com",tel:"0972018771",address:"testAddress"},message:"測試備註"}),_=J(),o=R(),b=H(),{cartItems:v}=b,f=Y(),{availableCoupon:d,selectedCoupon:p}=f.info;f.initInfo();const k=async()=>{const i=new Date,s=`${i.getFullYear()}${(i.getMonth()+1).toString().padStart(2,"0")}${i.getDay().toString().padStart(2,"0")}${i.getTime()}`,y=()=>{const m=v.reduce((r,a)=>(r[a.info.category]||(r[a.info.category]=[]),r[a.info.category].push(a),r),{}),u=r=>r.reduce((a,A)=>(a+=d?A.info.price*A.count*(p.percent/100):A.info.price*A.count,a),0),L=r=>r.map(a=>({id:a.info.id,name:a.info.title,imageUrl:a.info.imageUrl,quantity:a.count,price:d?a.info.price*(p.percent/100):a.info.price})),q=[];for(const r in m)q.push({id:`package${r}`,amount:u(m[r]),name:r,products:L(m[r])});return q},E={amount:d?Math.ceil(b.cartAmount*(p.percent/100)):b.cartAmount,currency:"TWD",orderId:s,packages:y(),redirectUrls:{confirmUrl:"https://lin-yu-hung.github.io/vue_Estore/#/eStore/confirmPay",cancelUrl:"https://lin-yu-hung.github.io/vue_Estore/#/eStore/confirmPay"}};console.log("🚀  params:",E);try{_.showLoading();const m=await U(E);m.status===200&&(window.location.href=m.data.info.paymentUrl.web)}catch(m){console.log(m),B("發生錯誤!")}finally{_.hideLoading()}};return{handlePayment:async(i,s)=>{if(s){_.showLoading();try{const y=v.map(u=>V({data:{product_id:u.info.id,qty:u.count}}));if((await Promise.all(y)).every(u=>u.data.success)){if(d){const u=await P({data:{code:p.code}});if(console.log(u),!u.data.success){_.hideLoading();return}}}else{_.hideLoading();return}}catch{_.hideLoading();return}i==="linePay"?await k():(await f.createOrder({data:n.value})&&(b.clearCart(),o.push("/eStore/userOrder")),_.hideLoading())}},cartItems:v,cart:b,availableCoupon:d,selectedCoupon:p,data:n}}},t=g=>(K("data-v-1aaeeea0"),g=g(),Q(),g),ee={class:"table-responsive shadow my-3 card"},oe={class:"table table-hover mt-2"},te=t(()=>e("thead",null,[e("tr",null,[e("th",{scope:"col"},"商品圖片"),e("th",{scope:"col"},"商品名稱"),e("th",{scope:"col"},"數量"),e("th",{scope:"col"},"單價"),e("th",{scope:"col"})])],-1)),se=["src","alt","title"],ae=t(()=>e("td",null,null,-1)),ne={class:"card shadow p-3 mb-3"},le={class:"container-fluid"},re={class:"row"},ce={class:"col-lg border-end"},de=t(()=>e("h2",{class:"fs-title border-bottom pb-2 mb-3"},"配送資訊",-1)),ie={class:"mb-2"},me=t(()=>e("label",{for:"name",class:"form-label"},"姓名",-1)),ue={class:"mb-2"},_e=t(()=>e("label",{for:"tel",class:"form-label"},"電話",-1)),fe={class:"mb-2"},pe=t(()=>e("label",{for:"email",class:"form-label"},"電子信箱",-1)),he={class:"mb-2"},be=t(()=>e("label",{for:"address",class:"form-label"},"地址",-1)),ge={class:"mb-2"},ye=t(()=>e("label",{for:"comment",class:"form-label"},"備註",-1)),ve={class:"col-lg d-column"},Ae=t(()=>e("h2",{class:"fs-title border-bottom pb-2 mb-3 mt-2 mt-lg-0"}," 付款資訊 ",-1)),we={class:"d-column flex-grow-1"},xe={class:"d-column align-items-end"},Se={class:"d-between w-40 mobile-w-100 text-nowrap mb-2"},Ce=t(()=>e("span",{class:"fs-6 text-secondary"}," 小記 ",-1)),ke={class:"fs-6 text-secondary"},Ee={key:0,class:"d-between align-items-center w-40 mobile-w-100 mb-2"},qe=t(()=>e("span",{class:"fs-6 text-secondary text-nowrap"}," 優惠券 ",-1)),Fe={class:"d-flex align-items-center fs-6 text-secondary border rounded ps-2 pe-1 py-1 mb-1"},Ie={class:"d-between w-40 mobile-w-100 text-nowrap mb-2"},Le=t(()=>e("span",{class:"fs-6 text-secondary"}," 折扣 ",-1)),Ve={class:"fs-6 text-secondary"},Pe=t(()=>e("hr",{class:"w-100 my-2"},null,-1)),Ue={class:"text-nowrap pt-2 mt-2 d-between w-40 mobile-w-100"},Be=t(()=>e("span",{class:"fs-4 mb-1 me-2"}," 總金額 ",-1)),De={class:"fs-4 mb-1"},We={class:"d-column flex-grow-1 justify-content-center mt-3 mt-md-0"},Ne=t(()=>e("h2",{class:"fs-title border-bottom pb-2 mb-3"},"付款方式",-1)),Oe=["onClick"],je=t(()=>e("img",{src:G,alt:"LINE-Pay"},null,-1)),Je=[je],Re=["onClick"];function Xe(g,n,_,o,b,v){const f=w("Field"),d=w("ErrorMessage"),p=w("font-awesome-icon"),k=w("Form");return x(),S(F,null,[e("div",ee,[e("table",oe,[te,e("tbody",null,[(x(!0),S(F,null,X(o.cartItems,l=>(x(),S("tr",{key:l.info.id},[e("td",null,[e("img",{src:l.info.imageUrl,alt:l.info.title,title:l.info.title},null,8,se)]),e("td",null,h(l.info.title),1),e("td",null,h(l.count),1),e("td",null,h(l.info.price.toLocaleString()),1),ae]))),128))])])]),e("div",ne,[c(k,null,{default:M(({errors:l,meta:i})=>[e("div",le,[e("div",re,[e("div",ce,[de,e("div",ie,[me,c(f,{id:"name",name:"姓名",type:"text",rules:"required",class:C(["form-control form-control-sm",{"is-invalid":l.姓名}]),placeholder:"請輸入姓名",modelValue:o.data.user.name,"onUpdate:modelValue":n[0]||(n[0]=s=>o.data.user.name=s)},null,8,["class","modelValue"]),c(d,{class:"text-danger invalid-feedback",name:"姓名"})]),e("div",ue,[_e,c(f,{id:"tel",name:"電話",type:"number",rules:{regex:/^[0-9]+$/,required:!0,max:10},class:C(["form-control form-control-sm",{"is-invalid":l.電話}]),placeholder:"請輸入電話",modelValue:o.data.user.tel,"onUpdate:modelValue":n[1]||(n[1]=s=>o.data.user.tel=s)},null,8,["class","modelValue"]),c(d,{class:"text-danger invalid-feedback",name:"電話"})]),e("div",fe,[pe,c(f,{id:"email",name:"電子信箱",type:"text",rules:{email:!0,required:!0},class:C(["form-control form-control-sm",{"is-invalid":l.電子信箱}]),placeholder:"請輸入電子信箱",modelValue:o.data.user.email,"onUpdate:modelValue":n[2]||(n[2]=s=>o.data.user.email=s)},null,8,["class","modelValue"]),c(d,{class:"text-danger invalid-feedback",name:"電子信箱"})]),e("div",he,[be,c(f,{id:"address",name:"地址",type:"text",rules:"required",class:C(["form-control form-control-sm",{"is-invalid":l.地址}]),placeholder:"請輸入地址",modelValue:o.data.user.address,"onUpdate:modelValue":n[3]||(n[3]=s=>o.data.user.address=s)},null,8,["class","modelValue"]),c(d,{class:"text-danger invalid-feedback",name:"地址"})]),e("div",ge,[ye,z(e("textarea",{class:"form-control form-control-sm",id:"comment",rows:"3",placeholder:"請輸入備註","onUpdate:modelValue":n[4]||(n[4]=s=>o.data.message=s)},null,512),[[T,o.data.message]])])]),e("div",ve,[Ae,e("div",we,[e("div",xe,[e("div",Se,[Ce,e("span",ke," $ "+h(o.cart.cartAmount.toLocaleString()),1)]),o.availableCoupon?(x(),S("div",Ee,[qe,e("div",Fe,[c(p,{icon:"fa-ticket",class:"me-3"}),I(" "+h(o.selectedCoupon.code),1)])])):Z("",!0),e("div",Ie,[Le,e("span",Ve," $ "+h(o.availableCoupon?(o.cart.cartAmount-o.cart.cartAmount*(o.selectedCoupon.percent/100)).toLocaleString():0),1)]),Pe,e("div",Ue,[Be,e("span",De," $ "+h(o.availableCoupon?(o.cart.cartAmount*(o.selectedCoupon.percent/100)).toLocaleString():o.cart.cartAmount.toLocaleString()),1)])]),e("div",We,[Ne,e("button",{type:"button",class:"btn border btn-hover mb-3 py-2",onClick:s=>o.handlePayment("linePay",i.valid)},Je,8,Oe),e("button",{class:"btn btn-primary py-2",type:"button",onClick:s=>o.handlePayment("cash",i.valid)},[c(p,{icon:"fa-coins"}),I("現金支付 ")],8,Re)])])])])])]),_:1})])],64)}const Qe=D($,[["render",Xe],["__scopeId","data-v-1aaeeea0"]]);export{Qe as default};
