import{i as R,m as le,h as ae,k as oe}from"./api-b7238d9c.js";import{e as U,s as K,d as se}from"./sweetAlert-a3663c0c.js";import{_ as ie,R as de,S as ne,U as re,E as ce,r as f,a as me,l as ue,t as _e,x as be,y as ge,b as C,o as u,c as _,d as t,D as q,h as n,w as F,v as T,F as j,C as H,q as O,i as z,n as V,Q,B as W,p as fe,k as pe}from"./index-200bbf47.js";import{p as ve}from"./product-8d774cb9.js";import{u as G}from"./util-d8e315e5.js";const he={components:{Field:de,Form:ne,ErrorMessage:re},setup(E,a){const B=ce("isVisitor");let e=f(""),S=f(null),k=f([]);const r=f([]),s=f({title:"",category:"",origin_price:0,price:0,unit:"",description:"",content:"",is_enabled:1}),b=me(),m=ue();_e(()=>b.path,i=>{I.value=b.fullPath==="/dashboard/editProduct",A()});const d=f(""),l=f(""),P=f({}),p=ve();console.log(p.editData);const{productList:L}=be(p),I=f(b.fullPath==="/dashboard/editProduct"),D=f(),M=()=>{L.value.forEach(i=>{P.value[i.id]=i})},X=ge(()=>L.value.length>0?(M(),L.value.filter(i=>i.title.match(l.value))):[]),J=i=>{s.value=JSON.parse(JSON.stringify(i)),e.value=i.imageUrl,i.imagesUrl?r.value=JSON.parse(JSON.stringify(i.imagesUrl)):r.value.splice(0),d.value=i.id},Y=async()=>{if(m.showLoading(),S.value!==null){const c=new FormData;c.append("file-to-upload",S.value);try{const g=await R(c);console.log(g),g.status===200&&(s.value.imageUrl=g.data.imageUrl)}catch(g){console.log(g)}S.value=null}else s.value.imageUrl=e.value;if(k.value.length!==0){const c=k.value.map(async y=>{const N=new FormData;N.append("file-to-upload",y);try{const x=await R(N);return x.status===200?x.data.imageUrl:null}catch{return null}}),g=await Promise.all(c);g.some(y=>y===null)?U("上傳失敗","請稍後在試或使用其他檔案"):!s.value.imagesUrl||s.value.imagesUrl.length===0?s.value.imagesUrl=[...g]:(console.log("🚀  data.value.imagesUrl:",s.value.imagesUrl),s.value.imagesUrl.push(...g)),k.value.splice(0)}else s.value.imagesUrl=[...r.value];const i={data:{...s.value}},v=I.value?le:ae,w=I.value?"編輯":"建立";try{const c=await v(i);console.log(c),c.data.success?(await p.getAllProductData(),K(`${w}成功!`),I.value||A()):U(`${w}失敗!`)}catch(c){U(`${w}失敗!`),console.log(c)}finally{m.hideLoading()}},Z=async(i,v="main")=>{const w=[...i.target.files],c=i.target.files.length;if(c===0)return;if(v!=="main"&&(c>5||c+r.value.length>5)){U("最多上傳5筆檔案");return}if(w.some(h=>!h.type||h.type!=="image/jpeg"&&h.type!=="image/png")){m.hideLoading(),U("檔案格式錯誤","僅能上傳jpg、png類型檔案");return}if(m.showLoading(),v=="main"){const h=w[0];try{const y=await G(h);e.value=y.result,S.value=h}catch{U("上傳失敗","請稍後在試或使用其他檔案")}}else{const h=w.map(async x=>{try{return(await G(x)).result}catch{return null}}),y=await Promise.all(h);y.some(x=>x===null)?U("上傳失敗","請稍後在試或使用其他檔案"):(r.value.push(...y),k.value=[...w],console.log("🚀  tempImgFiles.value:",k.value))}m.hideLoading()},$=i=>{r.value.splice(i,1),s.value.imagesUrl.splice(i,1)},ee=async()=>{if(await se(s.value.title)){m.showLoading();try{const v=await oe(s.value.id);console.log(v),v.data.success&&(await p.getAllProductData(),K("刪除成功!"),A())}catch(v){console.log(v)}finally{m.hideLoading()}}},A=async()=>{s.value={title:"",category:"",origin_price:0,price:0,unit:"",description:"",content:"",is_enabled:1},e.value="",r.value.splice(0),d.value="",setTimeout(()=>{D.value&&D.value.resetForm()},0)};return I.value&&(L.value.length===0?(m.showLoading(),p.getAllProductData().then(()=>{M(),m.hideLoading()})):M(),Object.keys(p.editData).length>0&&(J(p.editData),p.setEditData({}))),{data:s,imageUrl:e,imageList:r,isEditStatus:I,filterProductList:X,selectEditProduct:d,productKeyword:l,editDataMap:P,form:D,setProduct:Y,uploadImg:Z,delImage:$,setEditData:J,deleteProduct:ee,isVisitor:B}}},o=E=>(fe("data-v-e4c9e1cf"),E=E(),pe(),E),ye={class:"card pt-2"},Ve={class:"px-2 mb-2 d-between"},we={class:"mb-0"},xe={key:0,class:"input-group border rounded d-flex align-items-center"},Ue=["value"],ke={class:"dropdown-menu w-100 border-top-0"},Pe={class:"px-2 pt-1"},Ie={class:"product-list ps-0 mt-2 mb-0"},Ee=["onClick","value"],Se={class:"row border-top"},Fe={class:"col-md border-end pt-2"},Le=o(()=>t("label",{for:"name",class:"form-label"},"是否啟用",-1)),Ce={class:"form-check form-check-inline ms-3 mb-3"},De=["disabled"],Me=o(()=>t("label",{class:"form-check-label",for:"is_enableTrue",role:"button"},"是",-1)),Ae={class:"form-check form-check-inline"},Ne=["disabled"],qe=o(()=>t("label",{class:"form-check-label",for:"is_enableFalse",role:"button"},"否",-1)),Te={class:"mb-3"},je=o(()=>t("label",{for:"name",class:"form-label"},"商品名稱",-1)),He={class:"row mb-3"},Oe={class:"col-md mb-3 mb-md-0"},Be=o(()=>t("label",{for:"category",class:"form-label"},"分類",-1)),Je=o(()=>t("option",{selected:"",value:"",disabled:""},"請選擇分類",-1)),Re=o(()=>t("option",{value:"手機"},"手機",-1)),Ke=o(()=>t("option",{value:"平板"},"平板",-1)),ze=o(()=>t("option",{value:"電腦"},"電腦",-1)),Qe=o(()=>t("option",{value:"遊戲機"},"遊戲機",-1)),We=o(()=>t("option",{value:"3C配件"},"3C配件",-1)),Ge=o(()=>t("option",{value:"智慧手錶"},"智慧手錶",-1)),Xe={class:"col-md"},Ye=o(()=>t("label",{for:"unit",class:"form-label"},"單位",-1)),Ze={class:"row mb-3"},$e={class:"col-md mb-3 mb-md-0"},et=o(()=>t("label",{for:"origin_price",class:"form-label"},"原價",-1)),tt={class:"col-md"},lt=o(()=>t("label",{for:"price",class:"form-label"},"售價",-1)),at={class:"mb-3"},ot=o(()=>t("label",{for:"name",class:"form-label"},"產品描述",-1)),st={class:"mb-3"},it=o(()=>t("label",{for:"name",class:"form-label"},"說明內容",-1)),dt=["disabled"],nt={class:"col-md-5 col-lg-4 col-xxxl-3 d-column justify-content-between"},rt={class:"pt-2"},ct=o(()=>t("h5",{class:"my-2"},"商品主圖",-1)),mt=o(()=>t("hr",{class:"mt-0 mb-2"},null,-1)),ut={key:0,class:"uploadImg template-image mb-3",for:"uploadImg",role:"button"},_t={class:"d-column"},bt=o(()=>t("p",{class:"text-secondary mb-0"},"商品主圖",-1)),gt={key:1,class:"position-relative my-2"},ft=["src","alt"],pt=["disabled"],vt=o(()=>t("h5",{class:"my-2"},"商品附圖",-1)),ht=o(()=>t("hr",{class:"mt-0 mb-2"},null,-1)),yt={class:"d-flex flex-wrap"},Vt=["onClick"],wt=["src","alt"],xt={class:"d-column"},Ut=o(()=>t("p",{class:"text-secondary mb-0"},"商品附圖",-1)),kt={class:"d-flex mt-3 mb-2"},Pt=["disabled"],It=["disabled"];function Et(E,a,B,e,S,k){const r=C("font-awesome-icon"),s=C("Field"),b=C("ErrorMessage"),m=C("Form");return u(),_("div",ye,[t("div",Ve,[t("h2",we,q(e.isEditStatus?"修改":"建立")+"商品",1),e.isEditStatus?(u(),_("div",xe,[t("input",{type:"text",class:"form-control border-0 rounded",readonly:"",role:"button",placeholder:"請選擇編輯商品","data-bs-toggle":"dropdown","data-bs-auto-close":"true","aria-expanded":"false",value:e.selectEditProduct?e.editDataMap[e.selectEditProduct].title:""},null,8,Ue),n(r,{"data-bs-toggle":"dropdown","data-bs-auto-close":"true",role:"button","aria-expanded":"false",class:"me-3",icon:"fa-chevron-down"}),t("div",ke,[t("div",Pe,[F(t("input",{type:"text",placeholder:"查詢商品名稱",class:"form-control-sm border rounded w-100","onUpdate:modelValue":a[0]||(a[0]=d=>e.productKeyword=d)},null,512),[[T,e.productKeyword]]),t("ul",Ie,[(u(!0),_(j,null,H(e.filterProductList,d=>(u(),_("li",{class:V(["py-1",{active:e.selectEditProduct===d.id}]),onClick:l=>(e.selectEditProduct=d.id,e.setEditData(e.editDataMap[d.id])),key:d.id,value:d.id},q(d.title),11,Ee))),128))])])])])):O("",!0)]),n(m,{class:V([{cover:!e.selectEditProduct&&e.isEditStatus},"container-fluid"]),ref:"form",onSubmit:e.setProduct},{default:z(({errors:d})=>[t("div",Se,[t("div",Fe,[Le,t("div",Ce,[F(t("input",{class:"form-check-input",type:"radio",name:"is_enable",disabled:e.isVisitor,id:"is_enableTrue",value:1,"onUpdate:modelValue":a[1]||(a[1]=l=>e.data.is_enabled=l),checked:""},null,8,De),[[Q,e.data.is_enabled]]),Me]),t("div",Ae,[F(t("input",{class:"form-check-input",type:"radio",name:"is_enable",disabled:e.isVisitor,id:"is_enableFalse","onUpdate:modelValue":a[2]||(a[2]=l=>e.data.is_enabled=l),value:2},null,8,Ne),[[Q,e.data.is_enabled]]),qe]),t("div",Te,[je,n(s,{id:"title",name:"商品名稱",disabled:e.isVisitor,type:"text",rules:"required",class:V(["formInput form-control",{"is-invalid":d.商品名稱}]),placeHolder:"請輸入商品名稱",modelValue:e.data.title,"onUpdate:modelValue":a[3]||(a[3]=l=>e.data.title=l)},null,8,["disabled","class","modelValue"]),n(b,{class:"text-danger invalid-feedback",name:"商品名稱"})]),t("div",He,[t("div",Oe,[Be,n(s,{as:"select",id:"category",disabled:e.isVisitor,name:"分類",rules:"required",class:V(["form-select",{"is-invalid":d.分類}]),modelValue:e.data.category,"onUpdate:modelValue":a[4]||(a[4]=l=>e.data.category=l)},{default:z(()=>[Je,Re,Ke,ze,Qe,We,Ge]),_:2},1032,["disabled","class","modelValue"]),n(b,{class:"text-danger invalid-feedback",name:"分類"})]),t("div",Xe,[Ye,n(s,{id:"unit",name:"單位",type:"text",disabled:e.isVisitor,rules:"required",class:V(["formInput form-control",{"is-invalid":d.單位}]),placeHolder:"請輸入單位",modelValue:e.data.unit,"onUpdate:modelValue":a[5]||(a[5]=l=>e.data.unit=l)},null,8,["disabled","class","modelValue"]),n(b,{class:"text-danger invalid-feedback",name:"單位"})])]),t("div",Ze,[t("div",$e,[et,n(s,{id:"origin_price",name:"原價",type:"number",disabled:e.isVisitor,rules:"required",class:V(["formInput form-control",{"is-invalid":d.原價}]),placeHolder:"請輸入原價",modelValue:e.data.origin_price,"onUpdate:modelValue":a[6]||(a[6]=l=>e.data.origin_price=l),modelModifiers:{number:!0}},null,8,["disabled","class","modelValue"]),n(b,{class:"text-danger invalid-feedback",name:"原價"})]),t("div",tt,[lt,n(s,{id:"price",name:"售價",type:"number",disabled:e.isVisitor,rules:"required",class:V(["formInput form-control",{"is-invalid":d.售價}]),placeHolder:"請輸入售價",modelValue:e.data.price,"onUpdate:modelValue":a[7]||(a[7]=l=>e.data.price=l),modelModifiers:{number:!0}},null,8,["disabled","class","modelValue"]),n(b,{class:"text-danger invalid-feedback",name:"售價"})])]),t("div",at,[ot,n(s,{as:"textarea",name:"產品描述",type:"text",rules:"required",disabled:e.isVisitor,rows:"4",class:V(["form-control",{"is-invalid":d.產品描述}]),placeHolder:"請輸入產品描述",modelValue:e.data.description,"onUpdate:modelValue":a[8]||(a[8]=l=>e.data.description=l)},null,8,["disabled","class","modelValue"]),n(b,{class:"text-danger invalid-feedback",name:"產品描述"})]),t("div",st,[it,F(t("textarea",{rows:"4",class:"form-control",disabled:e.isVisitor,placeholder:"請輸入產品說明內容","onUpdate:modelValue":a[9]||(a[9]=l=>e.data.content=l)},null,8,dt),[[T,e.data.content]])])]),t("div",nt,[t("div",rt,[ct,mt,e.imageUrl?(u(),_("div",gt,[t("button",{type:"button",class:"btn-close position-absolute top-0","aria-label":"Close",onClick:a[10]||(a[10]=l=>e.imageUrl="")}),t("img",{class:"uploadImg mb-3",src:e.imageUrl,alt:e.imageUrl},null,8,ft)])):(u(),_("label",ut,[t("div",_t,[n(r,{class:"fs-2 mb-2 me-0 text-secondary",icon:"fa-image"}),bt])])),F(t("input",{type:"text","onUpdate:modelValue":a[11]||(a[11]=l=>e.imageUrl=l),disabled:e.isVisitor,class:"form-control rounded",placeholder:"輸入圖片網址"},null,8,pt),[[T,e.imageUrl]]),t("input",{onChange:a[12]||(a[12]=(...l)=>e.uploadImg&&e.uploadImg(...l)),id:"uploadImg",class:"form-control d-none",type:"file"},null,32),vt,ht,t("div",yt,[e.imageList.length>0?(u(!0),_(j,{key:0},H(e.imageList,(l,P)=>(u(),_("div",{class:"position-relative",key:l},[t("button",{type:"button",class:"btn-close position-absolute top-0","aria-label":"Close",onClick:p=>e.delImage(P)},null,8,Vt),t("img",{class:"uploadImgs mb-3",src:l,alt:l},null,8,wt)]))),128)):O("",!0),(u(!0),_(j,null,H(5-e.imageList.length,(l,P)=>(u(),_("label",{key:P,class:"uploadImgs template-image",for:"uploadImgs",role:"button"},[t("div",xt,[n(r,{class:"fs-4 mb-2 me-0 text-secondary",icon:"fa-image"}),Ut])]))),128)),t("input",{onChange:a[13]||(a[13]=l=>e.uploadImg(l,"multiple")),type:"file",class:"form-control d-none",id:"uploadImgs",multiple:""},null,32)])]),t("div",kt,[e.isEditStatus?(u(),_("button",{key:0,type:"button",class:"btn btn-danger text-white w-50 me-2",onClick:a[14]||(a[14]=(...l)=>e.deleteProduct&&e.deleteProduct(...l)),disabled:!e.selectEditProduct||e.isVisitor},[n(r,{icon:"fa-trash-can",class:"me-1"}),W("刪除商品 ")],8,Pt)):O("",!0),t("button",{type:"submit",disabled:e.isVisitor,class:V(["btn btn-primary flex-grow-1",{"ms-2":e.isEditStatus}])},[n(r,{icon:"fa-edit",class:"me-1"}),W(q(e.isEditStatus?"修改":"建立")+"商品 ",1)],10,It)])])])]),_:1},8,["class","onSubmit"])])}const Mt=ie(he,[["render",Et],["__scopeId","data-v-e4c9e1cf"]]);export{Mt as default};
