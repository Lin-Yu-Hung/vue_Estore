import{a as J,f as P,g as te,c as ae,s as O,d as le,e as oe}from"./api-08e3911e.js";import{_ as se,J as ie,K as ne,L as de,r as g,a as re,l as ce,n as ue,H as me,z as pe,B as L,o as m,c as p,b as t,C as q,h as d,w as D,v as B,F as H,D as R,j as T,i as K,M as w,R as z,E as W,p as _e,f as fe}from"./index-831c0040.js";import{p as ge}from"./product-68bfcb14.js";const G=k=>new Promise((l,x)=>{const e=new FileReader;e.readAsDataURL(k),e.onload=()=>{l(e)},e.onerror=()=>{x(null)}});const ve={components:{Field:ie,Form:ne,ErrorMessage:de},setup(k,l){let x=g(""),e=g(null),I=g([]);const v=g([]),o=g({title:"",category:"",origin_price:0,price:0,unit:"",description:"",content:"",is_enabled:1}),_=re(),r=ce();ue(()=>_.path,i=>{E.value=_.fullPath==="/dashboard/editProduct",A()});const F=g(""),n=g(""),a=g({}),u=ge(),{productList:S}=me(u),E=g(_.fullPath==="/dashboard/editProduct"),C=g(),M=()=>{S.value.forEach(i=>{a.value[i.id]=i})},Q=pe(()=>S.value.length>0?(M(),S.value.filter(i=>i.title.match(n.value))):[]),j=i=>{o.value=JSON.parse(JSON.stringify(i)),x.value=i.imageUrl,i.imagesUrl?v.value=JSON.parse(JSON.stringify(i.imagesUrl)):v.value.splice(0),F.value=i.id};E.value&&(S.value.length===0?u.getAllProductData().then(()=>{M()}):M(),Object.keys(u.editData).length>0&&(j(u.editData),u.setEditData({})));const X=async()=>{if(r.showLoading(),e.value!==null){const c=new FormData;c.append("file-to-upload",e.value);try{const f=await J(c);console.log(f),f.status===200&&(o.value.imageUrl=f.data.imageUrl)}catch(f){console.log(f)}e.value=null}else o.value.imageUrl=x.value;if(I.value.length!==0){const c=I.value.map(async y=>{const N=new FormData;N.append("file-to-upload",y);try{const V=await J(N);return V.status===200?V.data.imageUrl:null}catch{return null}}),f=await Promise.all(c);f.some(y=>y===null)?P("上傳失敗","請稍後在試或使用其他檔案"):!o.value.imagesUrl||o.value.imagesUrl.length===0?o.value.imagesUrl=[...f]:(console.log("🚀  data.value.imagesUrl:",o.value.imagesUrl),o.value.imagesUrl.push(...f)),I.value.splice(0)}else o.value.imagesUrl=[...v.value];const i={data:{...o.value}},b=E.value?te:ae,U=E.value?"編輯":"建立";try{const c=await b(i);console.log(c),c.data.success?(await u.getAllProductData(),O(`${U}成功!`),E.value||A()):P(`${U}失敗!`)}catch(c){P(`${U}失敗!`),console.log(c)}finally{r.hideLoading()}},Y=async(i,b="main")=>{const U=[...i.target.files],c=i.target.files.length;if(c===0)return;if(b!=="main"&&(c>5||c+v.value.length>5)){P("最多上傳5筆檔案");return}if(U.some(h=>!h.type||h.type!=="image/jpeg"&&h.type!=="image/png")){r.hideLoading(),P("檔案格式錯誤","僅能上傳jpg、png類型檔案");return}if(r.showLoading(),b=="main"){const h=U[0];try{const y=await G(h);x.value=y.result,e.value=h}catch{P("上傳失敗","請稍後在試或使用其他檔案")}}else{const h=U.map(async V=>{try{return(await G(V)).result}catch{return null}}),y=await Promise.all(h);y.some(V=>V===null)?P("上傳失敗","請稍後在試或使用其他檔案"):(v.value.push(...y),I.value=[...U],console.log("🚀  tempImgFiles.value:",I.value))}r.hideLoading()},Z=i=>{v.value.splice(i,1),o.value.imagesUrl.splice(i,1)},$=async()=>{if(await le(o.value.title)){r.showLoading();try{const b=await oe(o.value.id);console.log(b),b.data.success&&(await u.getAllProductData(),O("刪除成功!"),A())}catch(b){console.log(b)}finally{r.hideLoading()}}},A=async()=>{o.value={title:"",category:"",origin_price:0,price:0,unit:"",description:"",content:"",is_enabled:1},x.value="",v.value.splice(0),F.value="",setTimeout(()=>{C.value&&C.value.resetForm()},0)};return{data:o,imageUrl:x,imageList:v,isEditStatus:E,filterProductList:Q,selectEditProduct:F,productKeyword:n,editDataMap:a,form:C,setProduct:X,uploadImg:Y,delImage:Z,setEditData:j,deleteProduct:$}}},s=k=>(_e("data-v-f2df9360"),k=k(),fe(),k),be={class:"card pt-2"},he={class:"px-2 mb-2 d-between"},ye={class:"mb-0"},we={key:0,class:"input-group border rounded d-flex align-items-center"},xe=["value"],Ue={class:"dropdown-menu w-100 border-top-0"},ke={class:"px-2 pt-1"},Ve={class:"product-list ps-0 mt-2 mb-0"},Pe=["onClick","value"],Ie={class:"row border-top"},Ee={class:"col-md border-end pt-2"},Fe=s(()=>t("label",{for:"name",class:"form-label"},"是否啟用",-1)),Se={class:"form-check form-check-inline ms-3 mb-3"},Le=s(()=>t("label",{class:"form-check-label",for:"is_enableTrue",role:"button"},"是",-1)),De={class:"form-check form-check-inline"},Ce=s(()=>t("label",{class:"form-check-label",for:"is_enableFalse",role:"button"},"否",-1)),Me={class:"mb-3"},Ae=s(()=>t("label",{for:"name",class:"form-label"},"商品名稱",-1)),Ne={class:"row mb-3"},qe={class:"col-md mb-3 mb-md-0"},He=s(()=>t("label",{for:"category",class:"form-label"},"分類",-1)),Re=s(()=>t("option",{selected:"",value:"",disabled:""},"請選擇分類",-1)),Te=s(()=>t("option",{value:"衣服"},"衣服",-1)),je=s(()=>t("option",{value:"鞋子"},"鞋子",-1)),Je=s(()=>t("option",{value:"褲子"},"褲子",-1)),Oe=s(()=>t("option",{value:"其他"},"其他",-1)),Be={class:"col-md"},Ke=s(()=>t("label",{for:"unit",class:"form-label"},"單位",-1)),ze={class:"row mb-3"},We={class:"col-md mb-3 mb-md-0"},Ge=s(()=>t("label",{for:"origin_price",class:"form-label"},"原價",-1)),Qe={class:"col-md"},Xe=s(()=>t("label",{for:"price",class:"form-label"},"售價",-1)),Ye={class:"mb-3"},Ze=s(()=>t("label",{for:"name",class:"form-label"},"產品描述",-1)),$e={class:"mb-3"},et=s(()=>t("label",{for:"name",class:"form-label"},"說明內容",-1)),tt={class:"col-md-5 col-lg-4 col-xxxl-3 d-column justify-content-between"},at={class:"pt-2"},lt=s(()=>t("h5",{class:"my-2"},"商品主圖",-1)),ot=s(()=>t("hr",{class:"mt-0 mb-2"},null,-1)),st={key:0,class:"uploadImg template-image mb-3",for:"uploadImg",role:"button"},it={class:"d-column"},nt=s(()=>t("p",{class:"text-secondary mb-0"},"商品主圖",-1)),dt={key:1,class:"position-relative my-2"},rt=["src","alt"],ct=s(()=>t("h5",{class:"my-2"},"商品附圖",-1)),ut=s(()=>t("hr",{class:"mt-0 mb-2"},null,-1)),mt={class:"d-flex flex-wrap"},pt=["onClick"],_t=["src","alt"],ft={class:"d-column"},gt=s(()=>t("p",{class:"text-secondary mb-0"},"商品附圖",-1)),vt={class:"d-flex mt-3 mb-2"},bt=["disabled"];function ht(k,l,x,e,I,v){const o=L("font-awesome-icon"),_=L("Field"),r=L("ErrorMessage"),F=L("Form");return m(),p("div",be,[t("div",he,[t("h2",ye,q(e.isEditStatus?"修改":"建立")+"商品",1),e.isEditStatus?(m(),p("div",we,[t("input",{type:"text",class:"form-control border-0 rounded",readonly:"",role:"button",placeholder:"請選擇編輯商品","data-bs-toggle":"dropdown","data-bs-auto-close":"true","aria-expanded":"false",value:e.selectEditProduct?e.editDataMap[e.selectEditProduct].title:""},null,8,xe),d(o,{"data-bs-toggle":"dropdown","data-bs-auto-close":"true",role:"button","aria-expanded":"false",class:"me-3",icon:"fa-chevron-down"}),t("div",Ue,[t("div",ke,[D(t("input",{type:"text",placeholder:"查詢商品名稱",class:"form-control-sm border rounded w-100","onUpdate:modelValue":l[0]||(l[0]=n=>e.productKeyword=n)},null,512),[[B,e.productKeyword]]),t("ul",Ve,[(m(!0),p(H,null,R(e.filterProductList,n=>(m(),p("li",{class:w(["py-1",{active:e.selectEditProduct===n.id}]),onClick:a=>(e.selectEditProduct=n.id,e.setEditData(e.editDataMap[n.id])),key:n.id,value:n.id},q(n.title),11,Pe))),128))])])])])):T("",!0)]),d(F,{class:w([{cover:!e.selectEditProduct&&e.isEditStatus},"container-fluid"]),ref:"form",onSubmit:e.setProduct},{default:K(({errors:n})=>[t("div",Ie,[t("div",Ee,[Fe,t("div",Se,[D(t("input",{class:"form-check-input",type:"radio",name:"is_enable",id:"is_enableTrue",value:1,"onUpdate:modelValue":l[1]||(l[1]=a=>e.data.is_enabled=a),checked:""},null,512),[[z,e.data.is_enabled]]),Le]),t("div",De,[D(t("input",{class:"form-check-input",type:"radio",name:"is_enable",id:"is_enableFalse","onUpdate:modelValue":l[2]||(l[2]=a=>e.data.is_enabled=a),value:2},null,512),[[z,e.data.is_enabled]]),Ce]),t("div",Me,[Ae,d(_,{id:"title",name:"商品名稱",type:"text",rules:"required",class:w(["formInput form-control",{"is-invalid":n.商品名稱}]),placeHolder:"請輸入商品名稱",modelValue:e.data.title,"onUpdate:modelValue":l[3]||(l[3]=a=>e.data.title=a)},null,8,["class","modelValue"]),d(r,{class:"text-danger invalid-feedback",name:"商品名稱"})]),t("div",Ne,[t("div",qe,[He,d(_,{as:"select",id:"category",name:"分類",rules:"required",class:w(["form-select",{"is-invalid":n.分類}]),modelValue:e.data.category,"onUpdate:modelValue":l[4]||(l[4]=a=>e.data.category=a)},{default:K(()=>[Re,Te,je,Je,Oe]),_:2},1032,["class","modelValue"]),d(r,{class:"text-danger invalid-feedback",name:"分類"})]),t("div",Be,[Ke,d(_,{id:"unit",name:"單位",type:"text",rules:"required",class:w(["formInput form-control",{"is-invalid":n.單位}]),placeHolder:"請輸入單位",modelValue:e.data.unit,"onUpdate:modelValue":l[5]||(l[5]=a=>e.data.unit=a)},null,8,["class","modelValue"]),d(r,{class:"text-danger invalid-feedback",name:"單位"})])]),t("div",ze,[t("div",We,[Ge,d(_,{id:"origin_price",name:"原價",type:"number",rules:"required",class:w(["formInput form-control",{"is-invalid":n.原價}]),placeHolder:"請輸入原價",modelValue:e.data.origin_price,"onUpdate:modelValue":l[6]||(l[6]=a=>e.data.origin_price=a),modelModifiers:{number:!0}},null,8,["class","modelValue"]),d(r,{class:"text-danger invalid-feedback",name:"原價"})]),t("div",Qe,[Xe,d(_,{id:"price",name:"售價",type:"number",rules:"required",class:w(["formInput form-control",{"is-invalid":n.售價}]),placeHolder:"請輸入售價",modelValue:e.data.price,"onUpdate:modelValue":l[7]||(l[7]=a=>e.data.price=a),modelModifiers:{number:!0}},null,8,["class","modelValue"]),d(r,{class:"text-danger invalid-feedback",name:"售價"})])]),t("div",Ye,[Ze,d(_,{as:"textarea",name:"產品描述",type:"text",rules:"required",rows:"4",class:w(["form-control",{"is-invalid":n.產品描述}]),placeHolder:"請輸入產品描述",modelValue:e.data.description,"onUpdate:modelValue":l[8]||(l[8]=a=>e.data.description=a)},null,8,["class","modelValue"]),d(r,{class:"text-danger invalid-feedback",name:"產品描述"})]),t("div",$e,[et,D(t("textarea",{rows:"4",class:"form-control",placeholder:"請輸入產品說明內容","onUpdate:modelValue":l[9]||(l[9]=a=>e.data.content=a)},null,512),[[B,e.data.content]])])]),t("div",tt,[t("div",at,[lt,ot,e.imageUrl?(m(),p("div",dt,[t("button",{type:"button",class:"btn-close position-absolute top-0","aria-label":"Close",onClick:l[10]||(l[10]=a=>e.imageUrl="")}),t("img",{class:"uploadImg mb-3",src:e.imageUrl,alt:e.imageUrl},null,8,rt)])):(m(),p("label",st,[t("div",it,[d(o,{class:"fs-2 mb-2 me-0 text-secondary",icon:"fa-image"}),nt])])),t("input",{onChange:l[11]||(l[11]=(...a)=>e.uploadImg&&e.uploadImg(...a)),id:"uploadImg",class:"form-control d-none",type:"file"},null,32),ct,ut,t("div",mt,[e.imageList.length>0?(m(!0),p(H,{key:0},R(e.imageList,(a,u)=>(m(),p("div",{class:"position-relative",key:a},[t("button",{type:"button",class:"btn-close position-absolute top-0","aria-label":"Close",onClick:S=>e.delImage(u)},null,8,pt),t("img",{class:"uploadImgs mb-3",src:a,alt:a},null,8,_t)]))),128)):T("",!0),(m(!0),p(H,null,R(5-e.imageList.length,(a,u)=>(m(),p("label",{key:u,class:"uploadImgs template-image",for:"uploadImgs",role:"button"},[t("div",ft,[d(o,{class:"fs-4 mb-2 me-0 text-secondary",icon:"fa-image"}),gt])]))),128)),t("input",{onChange:l[12]||(l[12]=a=>e.uploadImg(a,"multiple")),type:"file",class:"form-control d-none",id:"uploadImgs",multiple:""},null,32)])]),t("div",vt,[e.isEditStatus?(m(),p("button",{key:0,type:"button",class:"btn btn-danger text-white w-50 me-2",onClick:l[13]||(l[13]=(...a)=>e.deleteProduct&&e.deleteProduct(...a)),disabled:!e.selectEditProduct},[d(o,{icon:"fa-trash-can",class:"me-1"}),W("刪除商品 ")],8,bt)):T("",!0),t("button",{type:"submit",class:w(["btn btn-primary flex-grow-1",{"ms-2":e.isEditStatus}])},[d(o,{icon:"fa-edit",class:"me-1"}),W(q(e.isEditStatus?"修改":"建立")+"商品 ",1)],2)])])])]),_:1},8,["class","onSubmit"])])}const Ut=se(ve,[["render",ht],["__scopeId","data-v-f2df9360"]]);export{Ut as default};
