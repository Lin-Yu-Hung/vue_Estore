import{a as R,f as P,g as te,c as ae,s as B,d as le,e as oe}from"./api-4c3baf88.js";import{_ as se,y as ie,z as ne,E as de,r as f,a as re,l as ce,f as ue,m as me,G as _e,h as L,o as m,c as _,b as t,A as q,i as d,w as D,v as J,F as T,C as j,q as H,j as K,B as w,I as z,k as G,t as pe,x as ge}from"./index-76bbfc66.js";import{p as fe}from"./product-d577f12d.js";const W=U=>new Promise((l,x)=>{const e=new FileReader;e.readAsDataURL(U),e.onload=()=>{l(e)},e.onerror=()=>{x(null)}});const ve={components:{Field:ie,Form:ne,ErrorMessage:de},setup(U,l){let x=f(""),e=f(null),I=f([]);const v=f([]),o=f({title:"",category:"",origin_price:0,price:0,unit:"",description:"",content:"",is_enabled:1}),p=re(),r=ce();ue(()=>p.path,i=>{E.value=p.fullPath==="/dashboard/editProduct",A()});const F=f(""),n=f(""),a=f({}),u=fe(),{productList:S}=me(u),E=f(p.fullPath==="/dashboard/editProduct"),C=f(),M=()=>{S.value.forEach(i=>{a.value[i.id]=i})},Q=_e(()=>S.value.length>0?(M(),S.value.filter(i=>i.title.match(n.value))):[]),O=i=>{o.value=JSON.parse(JSON.stringify(i)),x.value=i.imageUrl,i.imagesUrl?v.value=JSON.parse(JSON.stringify(i.imagesUrl)):v.value.splice(0),F.value=i.id};E.value&&(S.value.length===0?u.getAllProductData().then(()=>{M()}):M(),Object.keys(u.editData).length>0&&(O(u.editData),u.setEditData({})));const X=async()=>{if(r.showLoading(),e.value!==null){const c=new FormData;c.append("file-to-upload",e.value);try{const g=await R(c);console.log(g),g.status===200&&(o.value.imageUrl=g.data.imageUrl)}catch(g){console.log(g)}e.value=null}else o.value.imageUrl=x.value;if(I.value.length!==0){const c=I.value.map(async y=>{const N=new FormData;N.append("file-to-upload",y);try{const V=await R(N);return V.status===200?V.data.imageUrl:null}catch{return null}}),g=await Promise.all(c);g.some(y=>y===null)?P("上傳失敗","請稍後在試或使用其他檔案"):!o.value.imagesUrl||o.value.imagesUrl.length===0?o.value.imagesUrl=[...g]:(console.log("🚀  data.value.imagesUrl:",o.value.imagesUrl),o.value.imagesUrl.push(...g)),I.value.splice(0)}else o.value.imagesUrl=[...v.value];const i={data:{...o.value}},b=E.value?te:ae,k=E.value?"編輯":"建立";try{const c=await b(i);console.log(c),c.data.success?(await u.getAllProductData(),B(`${k}成功!`),E.value||A()):P(`${k}失敗!`)}catch(c){P(`${k}失敗!`),console.log(c)}finally{r.hideLoading()}},Y=async(i,b="main")=>{const k=[...i.target.files],c=i.target.files.length;if(c===0)return;if(b!=="main"&&(c>5||c+v.value.length>5)){P("最多上傳5筆檔案");return}if(k.some(h=>!h.type||h.type!=="image/jpeg"&&h.type!=="image/png")){r.hideLoading(),P("檔案格式錯誤","僅能上傳jpg、png類型檔案");return}if(r.showLoading(),b=="main"){const h=k[0];try{const y=await W(h);x.value=y.result,e.value=h}catch{P("上傳失敗","請稍後在試或使用其他檔案")}}else{const h=k.map(async V=>{try{return(await W(V)).result}catch{return null}}),y=await Promise.all(h);y.some(V=>V===null)?P("上傳失敗","請稍後在試或使用其他檔案"):(v.value.push(...y),I.value=[...k],console.log("🚀  tempImgFiles.value:",I.value))}r.hideLoading()},Z=i=>{v.value.splice(i,1),o.value.imagesUrl.splice(i,1)},$=async()=>{if(await le(o.value.title)){r.showLoading();try{const b=await oe(o.value.id);console.log(b),b.data.success&&(await u.getAllProductData(),B("刪除成功!"),A())}catch(b){console.log(b)}finally{r.hideLoading()}}},A=async()=>{o.value={title:"",category:"",origin_price:0,price:0,unit:"",description:"",content:"",is_enabled:1},x.value="",v.value.splice(0),F.value="",setTimeout(()=>{C.value&&C.value.resetForm()},0)};return{data:o,imageUrl:x,imageList:v,isEditStatus:E,filterProductList:Q,selectEditProduct:F,productKeyword:n,editDataMap:a,form:C,setProduct:X,uploadImg:Y,delImage:Z,setEditData:O,deleteProduct:$}}},s=U=>(pe("data-v-c7190230"),U=U(),ge(),U),be={class:"card pt-2"},he={class:"px-2 mb-2 d-between"},ye={class:"mb-0"},we={key:0,class:"input-group w-25 border rounded d-flex align-items-center"},xe=["value"],ke={class:"dropdown-menu w-100 border-top-0"},Ue={class:"px-2 pt-1"},Ve={class:"product-list ps-0 mt-2 mb-0"},Pe=["onClick","value"],Ie={class:"row border-top"},Ee={class:"col-md border-end pt-2"},Fe=s(()=>t("label",{for:"name",class:"form-label"},"是否啟用",-1)),Se={class:"form-check form-check-inline ms-3 mb-3"},Le=s(()=>t("label",{class:"form-check-label",for:"is_enableTrue",role:"button"},"是",-1)),De={class:"form-check form-check-inline"},Ce=s(()=>t("label",{class:"form-check-label",for:"is_enableFalse",role:"button"},"否",-1)),Me={class:"mb-3"},Ae=s(()=>t("label",{for:"name",class:"form-label"},"商品名稱",-1)),Ne={class:"row mb-3"},qe={class:"col-md mb-3 mb-md-0"},Te=s(()=>t("label",{for:"category",class:"form-label"},"分類",-1)),je=s(()=>t("option",{selected:"",value:"",disabled:""},"請選擇分類",-1)),He=s(()=>t("option",{value:"衣服"},"衣服",-1)),Oe=s(()=>t("option",{value:"鞋子"},"鞋子",-1)),Re=s(()=>t("option",{value:"褲子"},"褲子",-1)),Be=s(()=>t("option",{value:"其他"},"其他",-1)),Je={class:"col-md"},Ke=s(()=>t("label",{for:"unit",class:"form-label"},"單位",-1)),ze={class:"row mb-3"},Ge={class:"col-md mb-3 mb-md-0"},We=s(()=>t("label",{for:"origin_price",class:"form-label"},"原價",-1)),Qe={class:"col-md"},Xe=s(()=>t("label",{for:"price",class:"form-label"},"售價",-1)),Ye={class:"mb-3"},Ze=s(()=>t("label",{for:"name",class:"form-label"},"產品描述",-1)),$e={class:"mb-3"},et=s(()=>t("label",{for:"name",class:"form-label"},"說明內容",-1)),tt={class:"col-md-5 col-lg-4 col-xxxl-3 d-column justify-content-between"},at={class:"pt-2"},lt=s(()=>t("h5",{class:"my-2"},"商品主圖",-1)),ot=s(()=>t("hr",{class:"mt-0 mb-2"},null,-1)),st={key:0,class:"uploadImg template-image mb-3",for:"uploadImg",role:"button"},it={class:"d-column"},nt=s(()=>t("p",{class:"text-secondary mb-0"},"商品主圖",-1)),dt={key:1,class:"position-relative my-2"},rt=["src","alt"],ct=s(()=>t("h5",{class:"my-2"},"商品附圖",-1)),ut=s(()=>t("hr",{class:"mt-0 mb-2"},null,-1)),mt={class:"d-flex flex-wrap"},_t=["onClick"],pt=["src","alt"],gt={class:"d-column"},ft=s(()=>t("p",{class:"text-secondary mb-0"},"商品附圖",-1)),vt={class:"d-flex mt-3 mb-2"},bt=["disabled"];function ht(U,l,x,e,I,v){const o=L("font-awesome-icon"),p=L("Field"),r=L("ErrorMessage"),F=L("Form");return m(),_("div",be,[t("div",he,[t("h2",ye,q(e.isEditStatus?"修改":"建立")+"商品",1),e.isEditStatus?(m(),_("div",we,[t("input",{type:"text",class:"form-control border-0 rounded",readonly:"",role:"button",placeholder:"請選擇編輯商品","data-bs-toggle":"dropdown","data-bs-auto-close":"true","aria-expanded":"false",value:e.selectEditProduct?e.editDataMap[e.selectEditProduct].title:""},null,8,xe),d(o,{"data-bs-toggle":"dropdown","data-bs-auto-close":"true",role:"button","aria-expanded":"false",class:"me-3",icon:"fa-chevron-down"}),t("div",ke,[t("div",Ue,[D(t("input",{type:"text",placeholder:"查詢商品名稱",class:"form-control-sm border rounded w-100","onUpdate:modelValue":l[0]||(l[0]=n=>e.productKeyword=n)},null,512),[[J,e.productKeyword]]),t("ul",Ve,[(m(!0),_(T,null,j(e.filterProductList,n=>(m(),_("li",{class:w(["py-1",{active:e.selectEditProduct===n.id}]),onClick:a=>(e.selectEditProduct=n.id,e.setEditData(e.editDataMap[n.id])),key:n.id,value:n.id},q(n.title),11,Pe))),128))])])])])):H("",!0)]),d(F,{class:w([{cover:!e.selectEditProduct&&e.isEditStatus},"container-fluid"]),ref:"form",onSubmit:e.setProduct},{default:K(({errors:n})=>[t("div",Ie,[t("div",Ee,[Fe,t("div",Se,[D(t("input",{class:"form-check-input",type:"radio",name:"is_enable",id:"is_enableTrue",value:1,"onUpdate:modelValue":l[1]||(l[1]=a=>e.data.is_enabled=a),checked:""},null,512),[[z,e.data.is_enabled]]),Le]),t("div",De,[D(t("input",{class:"form-check-input",type:"radio",name:"is_enable",id:"is_enableFalse","onUpdate:modelValue":l[2]||(l[2]=a=>e.data.is_enabled=a),value:2},null,512),[[z,e.data.is_enabled]]),Ce]),t("div",Me,[Ae,d(p,{id:"title",name:"商品名稱",type:"text",rules:"required",class:w(["formInput form-control",{"is-invalid":n.商品名稱}]),placeHolder:"請輸入商品名稱",modelValue:e.data.title,"onUpdate:modelValue":l[3]||(l[3]=a=>e.data.title=a)},null,8,["class","modelValue"]),d(r,{class:"text-danger invalid-feedback",name:"商品名稱"})]),t("div",Ne,[t("div",qe,[Te,d(p,{as:"select",id:"category",name:"分類",rules:"required",class:w(["form-select",{"is-invalid":n.分類}]),modelValue:e.data.category,"onUpdate:modelValue":l[4]||(l[4]=a=>e.data.category=a)},{default:K(()=>[je,He,Oe,Re,Be]),_:2},1032,["class","modelValue"]),d(r,{class:"text-danger invalid-feedback",name:"分類"})]),t("div",Je,[Ke,d(p,{id:"unit",name:"單位",type:"text",rules:"required",class:w(["formInput form-control",{"is-invalid":n.單位}]),placeHolder:"請輸入單位",modelValue:e.data.unit,"onUpdate:modelValue":l[5]||(l[5]=a=>e.data.unit=a)},null,8,["class","modelValue"]),d(r,{class:"text-danger invalid-feedback",name:"單位"})])]),t("div",ze,[t("div",Ge,[We,d(p,{id:"origin_price",name:"原價",type:"number",rules:"required",class:w(["formInput form-control",{"is-invalid":n.原價}]),placeHolder:"請輸入原價",modelValue:e.data.origin_price,"onUpdate:modelValue":l[6]||(l[6]=a=>e.data.origin_price=a),modelModifiers:{number:!0}},null,8,["class","modelValue"]),d(r,{class:"text-danger invalid-feedback",name:"原價"})]),t("div",Qe,[Xe,d(p,{id:"price",name:"售價",type:"number",rules:"required",class:w(["formInput form-control",{"is-invalid":n.售價}]),placeHolder:"請輸入售價",modelValue:e.data.price,"onUpdate:modelValue":l[7]||(l[7]=a=>e.data.price=a),modelModifiers:{number:!0}},null,8,["class","modelValue"]),d(r,{class:"text-danger invalid-feedback",name:"售價"})])]),t("div",Ye,[Ze,d(p,{as:"textarea",name:"產品描述",type:"text",rules:"required",rows:"4",class:w(["form-control",{"is-invalid":n.產品描述}]),placeHolder:"請輸入產品描述",modelValue:e.data.description,"onUpdate:modelValue":l[8]||(l[8]=a=>e.data.description=a)},null,8,["class","modelValue"]),d(r,{class:"text-danger invalid-feedback",name:"產品描述"})]),t("div",$e,[et,D(t("textarea",{rows:"4",class:"form-control",placeholder:"請輸入產品說明內容","onUpdate:modelValue":l[9]||(l[9]=a=>e.data.content=a)},null,512),[[J,e.data.content]])])]),t("div",tt,[t("div",at,[lt,ot,e.imageUrl?(m(),_("div",dt,[t("button",{type:"button",class:"btn-close position-absolute top-0","aria-label":"Close",onClick:l[10]||(l[10]=a=>e.imageUrl="")}),t("img",{class:"uploadImg mb-3",src:e.imageUrl,alt:e.imageUrl},null,8,rt)])):(m(),_("label",st,[t("div",it,[d(o,{class:"fs-2 mb-2 me-0 text-secondary",icon:"fa-image"}),nt])])),t("input",{onChange:l[11]||(l[11]=(...a)=>e.uploadImg&&e.uploadImg(...a)),id:"uploadImg",class:"form-control d-none",type:"file"},null,32),ct,ut,t("div",mt,[e.imageList.length>0?(m(!0),_(T,{key:0},j(e.imageList,(a,u)=>(m(),_("div",{class:"position-relative",key:a},[t("button",{type:"button",class:"btn-close position-absolute top-0","aria-label":"Close",onClick:S=>e.delImage(u)},null,8,_t),t("img",{class:"uploadImgs mb-3",src:a,alt:a},null,8,pt)]))),128)):H("",!0),(m(!0),_(T,null,j(5-e.imageList.length,(a,u)=>(m(),_("label",{key:u,class:"uploadImgs template-image",for:"uploadImgs",role:"button"},[t("div",gt,[d(o,{class:"fs-4 mb-2 me-0 text-secondary",icon:"fa-image"}),ft])]))),128)),t("input",{onChange:l[12]||(l[12]=a=>e.uploadImg(a,"multiple")),type:"file",class:"form-control d-none",id:"uploadImgs",multiple:""},null,32)])]),t("div",vt,[e.isEditStatus?(m(),_("button",{key:0,type:"button",class:"btn btn-danger text-white w-50 me-2",onClick:l[13]||(l[13]=(...a)=>e.deleteProduct&&e.deleteProduct(...a)),disabled:!e.selectEditProduct},[d(o,{icon:"fa-trash-can",class:"me-1"}),G("刪除商品 ")],8,bt)):H("",!0),t("button",{type:"submit",class:w(["btn btn-primary flex-grow-1",{"ms-2":e.isEditStatus}])},[d(o,{icon:"fa-edit",class:"me-1"}),G(q(e.isEditStatus?"修改":"建立")+"商品 ",1)],2)])])])]),_:1},8,["class","onSubmit"])])}const kt=se(ve,[["render",ht],["__scopeId","data-v-c7190230"]]);export{kt as default};
