import{c as A}from"./cart-483c08a3.js";import{_ as k,l as L,n as x,r as y,o as a,c,b as o,F as b,z as g,w as M,O as V,y as l,H as f,j as S,p as P,f as I,t as w,v as D,x as C,h as v}from"./index-a766985b.js";import{c as $,t as N}from"./date-8f4434d3.js";import{a as T}from"./util-cb974d0d.js";import"./api-a221f4dd.js";import"./sweetAlert-5fecb7e2.js";const B={setup(d,s){const r=$(),t=L(),p=x(()=>r.pagination.current_page),u=x(()=>r.pagination.total_pages),e=y(null),{emit:_}=s;return{selectedCoupon:e,applyCoupon:()=>{_("applyCoupon",e.value)},coupon:r,timestampToYMD:N,currentPage:p,totalPages:u,getCoupons:async(i=1)=>{t.showLoading(),await r.getCoupons(i),t.hideLoading()}}}},U=d=>(P("data-v-4a9d10cd"),d=d(),I(),d),j={class:"modal fade",id:"couponModal",tabindex:"-1","aria-labelledby":"couponModalLabel","aria-hidden":"true"},z={class:"modal-dialog modal-dialog-centered modal-lg modal-dialog-scrollable"},F={class:"modal-content"},Y=U(()=>o("div",{class:"modal-header"},[o("h1",{class:"modal-title fs-5",id:"couponModalLabel"},"可使用優惠券"),o("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),E={class:"modal-body"},H=["for"],O={class:"container-fluid"},R={class:"row"},q={class:"col-2 border-end"},G={class:"d-center align-items-center h-100"},J=["id","value"],K={class:"col-8 col-md-6"},Q={class:"d-column py-2"},W={class:"text-secondary fs-small mb-2"},X={class:"text-secondary fs-small mb-2"},Z={class:"text-secondary fs-small mb-0"},oo={class:"col-2 col-md border-start"},to={class:"d-center align-items-center h-100"},eo={key:0,class:"d-end mt-3 pe-3"},so={"aria-label":"Page navigation example"},no={class:"pagination"},ao=["onClick"],co={class:"page-link"},lo={class:"modal-footer d-center"};function io(d,s,r,t,p,u){return a(),c("div",j,[o("div",z,[o("div",F,[Y,o("div",E,[(a(!0),c(b,null,g(t.coupon.coupons,(e,_)=>(a(),c("label",{key:_,class:"card card-hover-shadow mb-3",for:e.code,role:"button"},[o("div",O,[o("div",R,[o("div",q,[o("div",G,[M(o("input",{class:"form-check-input",type:"radio",name:"coupon",id:e.code,value:{code:e.code,percent:e.percent},"onUpdate:modelValue":s[0]||(s[0]=n=>t.selectedCoupon=n)},null,8,J),[[V,t.selectedCoupon]])])]),o("div",K,[o("div",Q,[o("p",W," 套用活動："+l(e.title),1),o("p",X," 優惠代碼："+l(e.code),1),o("p",Z," 有效期限："+l(t.timestampToYMD(e.due_date)),1)])]),o("div",oo,[o("div",to,l(e.percent/10)+"折 ",1)])])])],8,H))),128))]),t.totalPages>1?(a(),c("div",eo,[o("nav",so,[o("ul",no,[o("li",{class:f(["page-item",{invisible:t.currentPage===1}])},[o("a",{class:"page-link",onClick:s[1]||(s[1]=e=>t.getCoupons(t.currentPage-1))},"上一頁")],2),(a(!0),c(b,null,g(t.totalPages,(e,_)=>(a(),c("li",{class:f(["page-item",{active:t.currentPage===e}]),key:_,onClick:n=>t.getCoupons(e)},[o("a",co,l(e),1)],10,ao))),128)),o("li",{class:f(["page-item",{invisible:t.currentPage===t.totalPages}])},[o("a",{class:"page-link",onClick:s[2]||(s[2]=e=>t.getCoupons(t.currentPage+1))},"下一頁")],2)])])])):S("",!0),o("div",lo,[o("button",{type:"button",class:"btn btn-primary w-50","data-bs-dismiss":"modal","aria-label":"Close",onClick:s[3]||(s[3]=(...e)=>t.applyCoupon&&t.applyCoupon(...e))}," 套用 ")])])])])}const ro=k(B,[["render",io],["__scopeId","data-v-4a9d10cd"]]);const _o={components:{CouponModal:ro},setup(d){const s=$(),r=L();r.showLoading(),T().then(async()=>{await s.getCoupons(),r.hideLoading()});const t=A(),p=y(""),u=y(!1);return{cart:t,changeCount:(m,i)=>t.changeItemCount(i,m.target.value),setCoupon:m=>{p.value={...m},u.value=!0},selectedCoupon:p,availableCoupon:u,removeCoupon:()=>{u.value=!1,p.value=""}}}},h=d=>(P("data-v-3e3fe0a2"),d=d(),I(),d),po={key:0,class:"container-fluid pt-2"},uo={class:"row"},mo={class:"col-lg-7 col-xl-7"},ho={class:"table-responsive"},bo={class:"table table-hover"},vo=h(()=>o("thead",null,[o("tr",null,[o("th",{scope:"col",class:"text-center mobile-hide"},"商品圖片"),o("th",{scope:"col"},"商品名稱"),o("th",{scope:"col"},"數量"),o("th",{scope:"col"},"單價"),o("th",{scope:"col",class:"text-center"},"操作")])],-1)),go={scope:"row",class:"mobile-hide"},fo={class:"d-center"},Co=["src","alt","title"],yo={class:"mb-0 line-clamp-2"},xo={class:"d-end"},wo=["onChange"],ko=["selected"],Lo={class:"text-center"},Mo={class:"col"},So={class:"card p-3 shadow"},Po=h(()=>o("h2",{class:"fs-5 mb-3 border-bottom pb-2"},"訂單金額",-1)),Io={class:"d-flex align-items-center mb-3"},$o=h(()=>o("label",{for:"coupon",class:"form-label me-2 mb-0 text-nowrap"},"優惠券",-1)),Ao=["disabled"],Vo={class:"d-flex flex-column flex-sm-row justify-content-between"},Do={class:"mb-2 fs-6 text-decoration-underline",role:"button","data-bs-toggle":"modal","data-bs-target":"#couponModal"},No={key:0,class:"text-end text-green mb-0",role:"button"},To={class:"d-column align-items-end mt-2"},Bo={class:"d-between w-40 text-nowrap"},Uo=h(()=>o("span",{class:"fs-6 mb-1 text-secondary"}," 小記 ",-1)),jo={class:"fs-6 mb-1 text-secondary"},zo={class:"d-between w-40 text-nowrap"},Fo=h(()=>o("span",{class:"fs-6 mb-1 text-secondary"}," 折扣 ",-1)),Yo={class:"fs-6 mb-1 text-secondary"},Eo={class:"d-end text-nowrap border-top pt-2 mt-2"},Ho=h(()=>o("span",{class:"fs-4 mb-1 me-2"}," 總金額 ",-1)),Oo={class:"fs-4 mb-1"},Ro=h(()=>o("button",{class:"btn btn-primary mt-2"},"立即結帳",-1)),qo={key:1,class:"empty-text"};function Go(d,s,r,t,p,u){const e=w("font-awesome-icon"),_=w("CouponModal");return a(),c(b,null,[t.cart.cartItems.length>0?(a(),c("div",po,[o("div",uo,[o("div",mo,[o("div",ho,[o("table",bo,[vo,o("tbody",null,[(a(!0),c(b,null,g(t.cart.cartItems,(n,m)=>(a(),c("tr",{key:n},[o("th",go,[o("div",fo,[o("img",{src:n.info.imageUrl,alt:n.info.title,title:n.info.title},null,8,Co)])]),o("td",null,[o("p",yo,l(n.info.title),1)]),o("td",null,[o("div",xo,[o("select",{class:"form-select",onChange:i=>t.changeCount(i,m)},[(a(),c(b,null,g(30,i=>o("option",{selected:i==n.count,key:i},l(i),9,ko)),64))],40,wo)])]),o("td",null,l(n.info.price.toLocaleString()),1),o("td",Lo,[v(e,{role:"button",icon:"fa-trash-can",class:"text-secondary",onClick:i=>t.cart.delItem(m)},null,8,["onClick"])])]))),128))])])])]),o("div",Mo,[o("div",So,[Po,o("div",Io,[$o,M(o("input",{type:"text",class:"form-control form-control-sm",id:"coupon",placeholder:"請輸入優惠代碼","onUpdate:modelValue":s[0]||(s[0]=n=>t.selectedCoupon.code=n),disabled:t.availableCoupon},null,8,Ao),[[D,t.selectedCoupon.code]])]),o("div",Vo,[o("p",Do,[C(" 選用優惠券"),v(e,{class:"ms-1",icon:"fa-solid fa-arrow-right"})]),t.availableCoupon?(a(),c("p",No,[C(l(t.selectedCoupon.code)+" 優惠券 ",1),o("button",{type:"button",class:"btn-close pe-0",onClick:s[1]||(s[1]=(...n)=>t.removeCoupon&&t.removeCoupon(...n))})])):S("",!0)]),o("div",To,[o("div",Bo,[Uo,o("span",jo," $ "+l(t.cart.cartAmount.toLocaleString()),1)]),o("div",zo,[Fo,o("span",Yo," $ "+l((t.cart.cartAmount-t.cart.cartAmount*(t.selectedCoupon.percent/100)).toLocaleString()),1)])]),o("div",Eo,[Ho,o("span",Oo," $ "+l((t.cart.cartAmount*(t.selectedCoupon.percent/100)).toLocaleString()),1)]),Ro])])])])):(a(),c("h2",qo,[C(" 目前還未將商品加入購物車 "),v(e,{class:"ms-2",icon:"fa-face-frown"})])),v(_,{onApplyCoupon:t.setCoupon},null,8,["onApplyCoupon"])],64)}const ot=k(_o,[["render",Go],["__scopeId","data-v-3e3fe0a2"]]);export{ot as default};
