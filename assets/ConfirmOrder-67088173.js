import{b as P,c as B,s as D}from"./api-b7238d9c.js";import{e as F}from"./sweetAlert-a3663c0c.js";import{_ as W,R as N,S as O,U as R,r as J,l as X,u as j,b as C,o as A,c as w,d as e,F as L,C as M,h as c,i as T,D as h,n as k,w as Z,v as z,q as V,B as U,p as K,k as Q}from"./index-200bbf47.js";import{c as Y}from"./cart-0e6a5835.js";import{p as H}from"./pendingOrder-3e99662d.js";const G="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEoAAAAWCAYAAABnnAr9AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAttJREFUeNrsWDFoE1EY/isZggqecIJDIRk6VBAp6FqJU10q6tClFnSpS4d2cKrQBHTqkIqd6tBCMzlorYudoumqmEpBB4dEOhSa4QSRDoL+3/Xe+fead3lpcucJ+eAn79696919/b7v/UkfJRjp8rjFH8tc1j9+lHcpSjamuW4m4DlyJ6gHI/SI6hHVXSCjfntjh+tsSFYUvfEK1z2ulyI/1JxE8O/muMohzxJ2fx+XTmdofuDOobn6foMWd97Qpx/1SIlSCNtZ5Llsk7m7XK+41lpcS4b30OKGfZmuWheOzE+cH6ax7SK9bnxIvPWWBYmxAAqqOJ/94/mBiVgU1SlUz3PNYO1bw3WhePC15BIFK071X6dM2natWd/fo4fZ2+6csiZIPZM6SaXdTVpvvKfnF2fcczhe3a24Y1wz7Kl1pPo4MqLIyyHk2YIBqTkNgW0jkz4n8mqPng3ep1G26N/ztlvAJhP7/ddPdwwL41oQBRJBLD5XmbyoFFUTtisavPCQJtj72rnpxtDsoWOoy0qd8kmCiqA6EDLLapGAkg6Isn3CQNLBuUpkGTXj7VoyryjuvJr8suQrBxjbXnDJe1R7cWRHhIqUsqCkqf4R36Yy97qtKEe0DEoxrdZXm8y1BVjkG1sNL6ZeThKFMawIpUh7SrJAkrQp2oyow3zNy6Zpg7XVboQ5LBL872+xcqAUkIPABhmj9hXfVhKLOxt+4EvyTIjKN1mz0sazF7wmtFWbkNXcK98peSAJubQ0OOkHtA51T42qL4NClR1bETXX4U4E+9zi+mhA1NxxiFoXDeWWphOHKkCC2sWw0zlMgMXjoALRoCqiSho1RdEeKFsVNER0JbRNvqrI3AoDOvqwEJdEFQxevNZEYU/wg5ZYE1SG4/VLToDAMDXGCjSnqLAQP1bfEjfS5fF8VMpUjapS1FMmSpdPUVnvvwFyDD1W7/eohP56EAWqSXmOPwIMAC4oGDA1oHZWAAAAAElFTkSuQmCC";const $={components:{Field:N,Form:O,ErrorMessage:R},setup(y){const n=J({user:{name:"",email:"",tel:"",address:""},message:""}),p=X(),o=j(),b=Y(),{cartItems:S}=b,i=H(),{availableCoupon:d,selectedCoupon:f}=i.info;i.initInfo();const I=async()=>{const m=new Date,s=`${m.getFullYear()}${(m.getMonth()+1).toString().padStart(2,"0")}${m.getDay().toString().padStart(2,"0")}${m.getTime()}`,g=()=>{const u=S.reduce((r,a)=>(r[a.info.category]||(r[a.info.category]=[]),r[a.info.category].push(a),r),{}),q=r=>r.reduce((a,x)=>(a+=d?x.info.price*x.count*(f.percent/100):x.info.price*x.count,a),0),_=r=>r.map(a=>({id:a.info.id,name:a.info.title,imageUrl:a.info.imageUrl,quantity:a.count,price:d?a.info.price*(f.percent/100):a.info.price})),E=[];for(const r in u)E.push({id:`package${r}`,amount:q(u[r]),name:r,products:_(u[r])});return E},v={amount:d?Math.ceil(b.cartAmount*(f.percent/100)):b.cartAmount,currency:"TWD",orderId:s,packages:g(),redirectUrls:{confirmUrl:"https://lin-yu-hung.github.io/vue_Estore/#/eStore/confirmPay",cancelUrl:"https://lin-yu-hung.github.io/vue_Estore/#/eStore/confirmPay"}};console.log("🚀  params:",v);try{p.showLoading();const u=await D(v);u.status===200&&(window.location.href=u.data.info.paymentUrl.web)}catch(u){console.log(u),F("發生錯誤!")}finally{p.hideLoading()}};return{handlePayment:async(m,s)=>{if(!s){F("請填寫完整配送資訊!");return}p.showLoading();try{const v=S.map(_=>P({data:{product_id:_.info.id,qty:_.count}}));if((await Promise.all(v)).every(_=>_.data.success)){if(d){const _=await B({data:{code:f.code}});if(console.log(_),!_.data.success){p.hideLoading();return}}}else{p.hideLoading();return}}catch{p.hideLoading();return}const g=await i.createOrder({data:n.value});m==="linePay"?(i.setInfo({orderId:g.data.orderId}),await I()):(console.log("🚀  result:",g),g.success&&(o.push(`/eStore/completeOrder/${g.data.orderId}`),setTimeout(()=>{b.clearCart()},1e3)),p.hideLoading())},cartItems:S,cart:b,availableCoupon:d,selectedCoupon:f,data:n}}},t=y=>(K("data-v-58e5dbca"),y=y(),Q(),y),ee={class:"table-responsive shadow my-3 card"},oe={class:"table table-hover mt-2"},te=t(()=>e("thead",null,[e("tr",null,[e("th",{scope:"col"},"商品圖片"),e("th",{scope:"col"},"商品名稱"),e("th",{scope:"col"},"數量"),e("th",{scope:"col"},"單價"),e("th",{scope:"col"})])],-1)),se=["src","alt","title"],ae=t(()=>e("td",null,null,-1)),ne={class:"card shadow p-3 mb-3"},le={class:"container-fluid"},re={class:"row"},ce={class:"col-lg border-end"},de=t(()=>e("h2",{class:"fs-title border-bottom pb-2 mb-3"},"配送資訊",-1)),ie={class:"mb-2"},me=t(()=>e("label",{for:"name",class:"form-label"},"姓名",-1)),ue={class:"mb-2"},_e=t(()=>e("label",{for:"tel",class:"form-label"},"電話",-1)),pe={class:"mb-2"},fe=t(()=>e("label",{for:"email",class:"form-label"},"電子信箱",-1)),he={class:"mb-2"},be=t(()=>e("label",{for:"address",class:"form-label"},"地址",-1)),ge={class:"mb-2"},ye=t(()=>e("label",{for:"comment",class:"form-label"},"備註",-1)),ve={class:"col-lg d-column"},Ae=t(()=>e("h2",{class:"fs-title border-bottom pb-2 mb-3 mt-2 mt-lg-0"}," 付款資訊 ",-1)),we={class:"d-column flex-grow-1"},Se={class:"d-column align-items-end"},xe={class:"d-between w-40 mobile-w-100 text-nowrap mb-2"},Ce=t(()=>e("span",{class:"fs-6 text-secondary"}," 小記 ",-1)),ke={key:0,class:"fs-6 text-secondary"},Ie={key:0,class:"d-between align-items-center w-40 mobile-w-100 mb-2"},qe=t(()=>e("span",{class:"fs-6 text-secondary text-nowrap"}," 優惠券 ",-1)),Ee={class:"d-flex align-items-center fs-6 text-secondary border rounded ps-2 pe-1 py-1 mb-1"},Fe={class:"d-between w-40 mobile-w-100 text-nowrap mb-2"},Le=t(()=>e("span",{class:"fs-6 text-secondary"}," 折扣 ",-1)),Ve={class:"fs-6 text-secondary"},Ue=t(()=>e("hr",{class:"w-100 my-2"},null,-1)),Pe={class:"text-nowrap pt-2 mt-2 d-between w-40 mobile-w-100"},Be=t(()=>e("span",{class:"fs-4 mb-1 me-2"}," 總金額 ",-1)),De={class:"fs-4 mb-1"},We={class:"d-column flex-grow-1 justify-content-center mt-3 mt-md-0"},Ne=t(()=>e("h2",{class:"fs-title border-bottom pb-2 mb-3"},"付款方式",-1)),Oe=["onClick"],Re=t(()=>e("img",{src:G,alt:"LINE-Pay"},null,-1)),Je=[Re],Xe=["onClick"];function je(y,n,p,o,b,S){const i=C("Field"),d=C("ErrorMessage"),f=C("font-awesome-icon"),I=C("Form");return A(),w(L,null,[e("div",ee,[e("table",oe,[te,e("tbody",null,[(A(!0),w(L,null,M(o.cartItems,l=>(A(),w("tr",{key:l.info.id},[e("td",null,[e("img",{src:l.info.imageUrl,alt:l.info.title,title:l.info.title},null,8,se)]),e("td",null,h(l.info.title),1),e("td",null,h(l.count),1),e("td",null,h(l.info.price.toLocaleString()),1),ae]))),128))])])]),e("div",ne,[c(I,null,{default:T(({errors:l,meta:m})=>[e("div",le,[e("div",re,[e("div",ce,[de,e("div",ie,[me,c(i,{id:"name",name:"姓名",type:"text",rules:"required",class:k(["form-control form-control-sm",{"is-invalid":l.姓名}]),placeholder:"請輸入姓名",modelValue:o.data.user.name,"onUpdate:modelValue":n[0]||(n[0]=s=>o.data.user.name=s)},null,8,["class","modelValue"]),c(d,{class:"text-danger invalid-feedback",name:"姓名"})]),e("div",ue,[_e,c(i,{id:"tel",name:"電話",type:"number",rules:{regex:/^[0-9]+$/,required:!0,max:10},class:k(["form-control form-control-sm",{"is-invalid":l.電話}]),placeholder:"請輸入電話",modelValue:o.data.user.tel,"onUpdate:modelValue":n[1]||(n[1]=s=>o.data.user.tel=s)},null,8,["class","modelValue"]),c(d,{class:"text-danger invalid-feedback",name:"電話"})]),e("div",pe,[fe,c(i,{id:"email",name:"電子信箱",type:"text",rules:{email:!0,required:!0},class:k(["form-control form-control-sm",{"is-invalid":l.電子信箱}]),placeholder:"請輸入電子信箱",modelValue:o.data.user.email,"onUpdate:modelValue":n[2]||(n[2]=s=>o.data.user.email=s)},null,8,["class","modelValue"]),c(d,{class:"text-danger invalid-feedback",name:"電子信箱"})]),e("div",he,[be,c(i,{id:"address",name:"地址",type:"text",rules:"required",class:k(["form-control form-control-sm",{"is-invalid":l.地址}]),placeholder:"請輸入地址",modelValue:o.data.user.address,"onUpdate:modelValue":n[3]||(n[3]=s=>o.data.user.address=s)},null,8,["class","modelValue"]),c(d,{class:"text-danger invalid-feedback",name:"地址"})]),e("div",ge,[ye,Z(e("textarea",{class:"form-control form-control-sm",id:"comment",rows:"3",placeholder:"請輸入備註","onUpdate:modelValue":n[4]||(n[4]=s=>o.data.message=s)},null,512),[[z,o.data.message]])])]),e("div",ve,[Ae,e("div",we,[e("div",Se,[e("div",xe,[Ce,o.cart.cartAmount?(A(),w("span",ke," $ "+h(o.cart.cartAmount.toLocaleString()),1)):V("",!0)]),o.availableCoupon?(A(),w("div",Ie,[qe,e("div",Ee,[c(f,{icon:"fa-ticket",class:"me-3"}),U(" "+h(o.selectedCoupon.code),1)])])):V("",!0),e("div",Fe,[Le,e("span",Ve," $ "+h(o.availableCoupon?(o.cart.cartAmount-o.cart.cartAmount*(o.selectedCoupon.percent/100)).toLocaleString():0),1)]),Ue,e("div",Pe,[Be,e("span",De," $ "+h(o.availableCoupon?(o.cart.cartAmount*(o.selectedCoupon.percent/100)).toLocaleString():o.cart.cartAmount.toLocaleString()),1)])]),e("div",We,[Ne,e("button",{type:"button",class:"btn border btn-hover mb-3 py-2",onClick:s=>o.handlePayment("linePay",m.valid)},Je,8,Oe),e("button",{class:"btn btn-primary py-2",type:"button",onClick:s=>o.handlePayment("cash",m.valid)},[c(f,{icon:"fa-coins"}),U("現金支付 ")],8,Xe)])])])])])]),_:1})])],64)}const Qe=W($,[["render",je],["__scopeId","data-v-58e5dbca"]]);export{Qe as default};
