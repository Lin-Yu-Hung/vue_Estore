import{_ as A,r as g,b as U,o as a,G as T,E as B,l as W,y as j,c as l,d as t,h as y,B as D,w as v,v as b,q as I,F as L,C as S,n as M,D as d,e as K,p as q,k as E}from"./index-ab37e322.js";import{n as F,o as G,p as J}from"./api-f5aadb85.js";import{t as Y}from"./date-44c8fab1.js";import{d as z,s as P,e as R}from"./sweetAlert-a356a5ee.js";import{c as H}from"./bootstrap-dab3bd6e.js";const Q={props:{sortList:{type:Array,default:[]},sortItem:{type:String,default:""}},setup(c,s){const m=g("fa-arrow-up-wide-short");return{icon:m,toggleIcon:()=>{m.value=m.value==="fa-arrow-up-wide-short"?"fa-arrow-down-short-wide":"fa-arrow-up-wide-short";const u=m.value==="fa-arrow-up-wide-short"?"up":"down";c.sortItem&&c.sortList.sort((h,r)=>u==="up"?r[c.sortItem]-h[c.sortItem]:h[c.sortItem]-r[c.sortItem])}}}};function X(c,s,m,e,u,h){const r=U("font-awesome-icon");return a(),T(r,{icon:e.icon,role:"button",onClick:e.toggleIcon},null,8,["icon","onClick"])}const Z=A(Q,[["render",X]]);const $={components:{DataSortIcon:Z},setup(){const c=B("isVisitor"),s=W(),m=g([]),e=g(""),u=g({}),h=g({}),r=g(0),x=g(""),f=async(n=1)=>{try{s.showLoading();const _=await F(n);console.log(_),_.data.success&&(m.value=[..._.data.orders],u.value={..._.data.pagination})}catch(_){console.log(_)}finally{s.hideLoading()}},C=(n,_="view")=>{if(x.value=_,h.value=JSON.parse(JSON.stringify(n)),_==="view"){const V=Object.entries(n.products).reduce((k,N)=>(k+=N[1].total,k),0);r.value=V-n.total}},O=j(()=>m.value.filter(n=>n.id.match(e.value))),w=async(n,_,V)=>{try{s.showLoading(),(await n(..._)).status===200&&(await f(u.value.current_page),H("exampleModal"),P(`${V}成功`)),s.hideLoading()}catch(k){R("發生錯誤!"),console.log(k)}},o=async n=>{await z(n.id)&&w(G,[n.id],"刪除")},p=async()=>{w(J,[h.value.id,{data:h.value}],"修改")};return f(1),{showData:O,pageInfo:u,timestampToYMD:Y,orderKeyWord:e,getOrderList:f,orderList:m,orderDetail:h,setOrderDetail:C,orderDiscount:r,deleteOrder:o,modalMode:x,UpdateOrder:p,isVisitor:c}}},i=c=>(q("data-v-622b8d28"),c=c(),E(),c),tt={class:"container-fluid"},et={class:"d-between align-items-center"},ot={class:"fs-5"},st={class:"border px-3 rounded-5 d-center align-items-center w-25 my-2"},at={key:0,class:"card shadow table-responsive"},lt={class:"table"},nt={class:"bg-light"},it=i(()=>t("th",{scope:"col",class:"mobile-hide"},null,-1)),dt={scope:"col"},ct=i(()=>t("th",{scope:"col",class:"text-center"},"是否付款",-1)),rt=i(()=>t("th",{scope:"col",class:"mobile-hide"},"訂單編號",-1)),_t={scope:"col",class:"text-end mobile-hide"},mt=i(()=>t("th",{scope:"col",class:"text-end"},"詳細資料",-1)),ht={key:0,scope:"col",class:"text-center"},pt=i(()=>t("td",{class:"mobile-hide"},null,-1)),ut={scope:"col",class:"text-center"},vt={class:"mobile-hide"},gt={class:"text-end mobile-hide"},ft={class:"text-end"},yt=["onClick"],bt={key:0},xt={class:"d-flex justify-content-center flex-wrap"},wt=["onClick"],kt=["onClick"],Dt={key:1,"aria-label":"Page navigation example",class:"mt-3 d-end"},It={class:"pagination"},Lt=i(()=>t("a",{class:"page-link"},"上一頁",-1)),Ct=[Lt],Ot=["onClick"],Mt={class:"page-link"},Vt=i(()=>t("a",{class:"page-link"},"下一頁",-1)),St=[Vt],Ut={class:"modal fade",id:"exampleModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},At={class:"modal-dialog modal-dialog-centered modal-md"},Nt={class:"modal-content"},Tt=i(()=>t("div",{class:"modal-header"},[t("h1",{class:"modal-title fs-5",id:"exampleModalLabel"},"詳細資訊"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),Bt={class:"modal-body"},Wt=i(()=>t("h2",{class:"fs-5 border-bottom pb-3"},"訂貨人資訊",-1)),jt={key:0,class:"container-fluid"},Kt={class:"row g-3 text-nowrap"},qt={class:"col-md-6"},Et={class:"row align-items-center"},Ft=i(()=>t("div",{class:"col-3 col-md"},"姓名",-1)),Gt={class:"col"},Jt={key:0},Yt={class:"col-md-6"},zt={class:"row align-items-center"},Pt=i(()=>t("div",{class:"col-3 col-md-5 text-md-end"},"電話",-1)),Rt={class:"col"},Ht={key:0},Qt={class:"col-12"},Xt={class:"row align-items-center"},Zt=i(()=>t("div",{class:"col-3"},"地址",-1)),$t={class:"col"},te={key:0},ee={class:"col-12"},oe={class:"row align-items-center"},se=i(()=>t("div",{class:"col-3"},"電子信箱",-1)),ae={class:"col"},le={key:0},ne={class:"col-12"},ie={class:"row align-items-center"},de=i(()=>t("div",{class:"col-3"},"備註",-1)),ce={class:"col"},re={key:0},_e={class:"col-12"},me={class:"row align-items-center"},he=i(()=>t("div",{class:"col-3"},"是否付款",-1)),pe={class:"col"},ue={key:0},ve=i(()=>t("h2",{class:"fs-5 border-bottom py-3 mt-3"},"商品資訊",-1)),ge={class:"table"},fe=i(()=>t("thead",null,[t("tr",null,[t("th",{scope:"col"},"商品名稱"),t("th",{scope:"col",class:"text-nowrap text-end"},"數量"),t("th",{scope:"col",class:"text-end"},"單價")])],-1)),ye={class:"text-end"},be={class:"text-end"},xe={class:"text-end text-small text-secondary"},we={class:"fs-5 text-end"},ke={key:2,class:"d-end mt-3"};function De(c,s,m,e,u,h){var f,C,O,w;const r=U("font-awesome-icon"),x=U("DataSortIcon");return a(),l(L,null,[t("div",tt,[t("div",et,[t("h2",ot,[y(r,{icon:"fa-file-lines",role:"button",class:"text-secondary me-2 ms-1"}),D("訂單列表 ")]),t("div",st,[y(r,{icon:"fa-search",role:"button"}),v(t("input",{type:"text",class:"form-control form-control-sm border-0",placeholder:"查詢訂單編號","onUpdate:modelValue":s[0]||(s[0]=o=>e.orderKeyWord=o)},null,512),[[b,e.orderKeyWord]])])]),e.showData.length>0?(a(),l("div",at,[t("table",lt,[t("thead",null,[t("tr",nt,[it,t("th",dt,[D(" 建立日期 "),y(x,{sortList:e.orderList,sortItem:"create_at"},null,8,["sortList"])]),ct,rt,t("th",_t,[D(" 訂單金額 "),y(x,{sortList:e.orderList,sortItem:"total"},null,8,["sortList"])]),mt,e.isVisitor?I("",!0):(a(),l("th",ht,"操作"))])]),t("tbody",null,[(a(!0),l(L,null,S(e.showData,o=>{var p;return a(),l("tr",{key:o.id},[pt,t("td",null,d(e.timestampToYMD(o.create_at)),1),t("td",ut,[t("p",{class:M(["fixed-width-80 status-text text-center",{"bg-success text-green":o.is_paid,"bg-red text-white":!o.is_paid}])},d(o.is_paid?"已付款":"尚未付款"),3)]),t("td",vt,d(o.id),1),t("td",gt,d((p=o.total)==null?void 0:p.toLocaleString()),1),t("td",ft,[t("span",{"data-bs-toggle":"modal","data-bs-target":"#exampleModal",class:"text-underline-hover text-link",onClick:n=>e.setOrderDetail(o)}," 詳細資料 ",8,yt)]),e.isVisitor?I("",!0):(a(),l("td",bt,[t("div",xt,[t("button",{type:"button",class:"edit-btn","data-bs-toggle":"modal","data-bs-target":"#exampleModal",onClick:n=>e.setOrderDetail(o,"edit")},[y(r,{icon:"fa-edit"}),D("編輯 ")],8,wt),t("button",{type:"button",class:"danger-btn",onClick:n=>e.deleteOrder(o)},[y(r,{icon:"fa-trash-can"}),D("刪除 ")],8,kt)])]))])}),128))])])])):I("",!0),e.pageInfo.total_pages>1?(a(),l("nav",Dt,[t("ul",It,[t("li",{class:M(["page-item",{invisible:!e.pageInfo.has_pre}]),onClick:s[1]||(s[1]=o=>e.getOrderList(--e.pageInfo.current_page))},Ct,2),(a(!0),l(L,null,S(e.pageInfo.total_pages,o=>(a(),l("li",{class:M(["page-item",{active:e.pageInfo.current_page===o}]),key:o,onClick:p=>e.getOrderList(o)},[t("a",Mt,d(o),1)],10,Ot))),128)),t("li",{class:M(["page-item",{invisible:!e.pageInfo.has_next}]),onClick:s[2]||(s[2]=o=>e.getOrderList(++e.pageInfo.current_page))},St,2)])])):I("",!0)]),t("div",Ut,[t("div",At,[t("div",Nt,[Tt,t("div",Bt,[Wt,e.orderDetail.user?(a(),l("div",jt,[t("div",Kt,[t("div",qt,[t("div",Et,[Ft,t("div",Gt,[e.modalMode==="view"?(a(),l("span",Jt,d((f=e.orderDetail.user)==null?void 0:f.name),1)):v((a(),l("input",{key:1,type:"text",class:"form-control form-control-sm",placeholder:"姓名","onUpdate:modelValue":s[3]||(s[3]=o=>e.orderDetail.user.name=o)},null,512)),[[b,e.orderDetail.user.name]])])])]),t("div",Yt,[t("div",zt,[Pt,t("div",Rt,[e.modalMode==="view"?(a(),l("span",Ht,d((C=e.orderDetail.user)==null?void 0:C.tel),1)):v((a(),l("input",{key:1,type:"tel",class:"form-control form-control-sm",placeholder:"電話","onUpdate:modelValue":s[4]||(s[4]=o=>e.orderDetail.user.tel=o)},null,512)),[[b,e.orderDetail.user.tel]])])])]),t("div",Qt,[t("div",Xt,[Zt,t("div",$t,[e.modalMode==="view"?(a(),l("span",te,d((O=e.orderDetail.user)==null?void 0:O.address),1)):v((a(),l("input",{key:1,type:"text",class:"form-control form-control-sm",placeholder:"地址","onUpdate:modelValue":s[5]||(s[5]=o=>e.orderDetail.user.address=o)},null,512)),[[b,e.orderDetail.user.address]])])])]),t("div",ee,[t("div",oe,[se,t("div",ae,[e.modalMode==="view"?(a(),l("span",le,d((w=e.orderDetail.user)==null?void 0:w.email),1)):v((a(),l("input",{key:1,type:"email",class:"form-control form-control-sm",placeholder:"電子信箱","onUpdate:modelValue":s[6]||(s[6]=o=>e.orderDetail.user.email=o)},null,512)),[[b,e.orderDetail.user.email]])])])]),t("div",ne,[t("div",ie,[de,t("div",ce,[e.modalMode==="view"?(a(),l("span",re,d(e.orderDetail.message),1)):v((a(),l("input",{key:1,type:"text",class:"form-control form-control-sm",placeholder:"備註","onUpdate:modelValue":s[7]||(s[7]=o=>e.orderDetail.message=o)},null,512)),[[b,e.orderDetail.message]])])])]),t("div",_e,[t("div",me,[he,t("div",pe,[e.modalMode==="view"?(a(),l("span",ue,d(e.orderDetail.is_paid?"是":"否"),1)):v((a(),l("input",{key:1,class:"form-check-input",type:"checkbox",id:"flexCheckDefault","onUpdate:modelValue":s[8]||(s[8]=o=>e.orderDetail.is_paid=o)},null,512)),[[K,e.orderDetail.is_paid]])])])])])])):I("",!0),e.modalMode==="view"?(a(),l(L,{key:1},[ve,t("table",ge,[fe,t("tbody",null,[(a(!0),l(L,null,S(e.orderDetail.products,o=>{var p,n;return a(),l("tr",{key:o.id},[t("td",null,d((p=o.product)==null?void 0:p.title),1),t("td",ye,d(o.qty),1),t("td",be,d((n=o.total)==null?void 0:n.toLocaleString()),1)])}),128))])]),t("p",xe," 折扣："+d(e.orderDiscount),1),t("h2",we,"總金額："+d(e.orderDetail.total),1)],64)):(a(),l("div",ke,[t("button",{class:"btn btn-primary-light px-4",onClick:s[9]||(s[9]=(...o)=>e.UpdateOrder&&e.UpdateOrder(...o))}," 儲存 ")]))])])])])],64)}const Ve=A($,[["render",De],["__scopeId","data-v-622b8d28"]]);export{Ve as default};
